<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATIƒå√ÅK - Matiƒçn√≠ AI Pomocn√≠k</title>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 352px;
            height: 528px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 16px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 18px;
            margin-bottom: 2px;
            font-style: italic;
        }

        .header p {
            font-size: 9px;
            opacity: 0.9;
        }
        
        /* ≈òeƒçov√° bublina NOV√â v hlaviƒçce */
        .novinka-badge {
            position: absolute;
            top: -55px;
            left: 15px;
            background: white;
            color: #333;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            animation: blinkBadge 2s ease-in-out infinite, floatBubble 3s ease-in-out infinite;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 3px solid #ff6b6b;
        }
        
        /* ≈†ipka ≈ôeƒçov√© bubliny - ukazuje dol≈Ø na hlaviƒçku */
        .novinka-badge::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 25%;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 12px solid white;
            filter: drop-shadow(0 3px 4px rgba(0, 0, 0, 0.15));
        }
        
        .novinka-badge::before {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 25%;
            width: 0;
            height: 0;
            border-left: 13px solid transparent;
            border-right: 13px solid transparent;
            border-top: 13px solid #ff6b6b;
            margin-left: -1px;
        }
        
        .novinka-badge:hover {
            transform: scale(1.15) translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
        }
        
        .novinka-icon {
            font-size: 13px;
        }
        
        .novinka-text {
            font-size: 11px;
            letter-spacing: 0.5px;
            color: #ff6b6b;
        }
        
        @keyframes floatBubble {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes blinkBadge {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.05);
            }
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-5px) rotate(-10deg);
            }
            75% {
                transform: translateY(-3px) rotate(10deg);
            }
        }

        /* Minimalistick√© tlaƒç√≠tko v z√°hlav√≠ */
        .header-close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .header-close-btn:hover {
            opacity: 0.7;
            transform: scale(1.1);
        }

        .header-close-btn:active {
            transform: scale(0.95);
        }

        .chat-container {
            flex: 2;
            overflow-y: auto;
            padding: 16px;
            background: #f5f5f5;
            position: relative;
        }

        .quick-buttons-fixed {
            position: relative;
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            padding: 14px 24px;
            display: flex;
            gap: 8px;
            justify-content: center;
            z-index: 500;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            border-bottom: 1px solid #e0e0e0;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }
        
        .message.announcement-message {
            animation: fadeIn 0.5s ease-in, pulse 2s ease-in-out;
        }
        
        .announcement-bubble {
            user-select: none;
        }
        
        .announcement-expanded {
            animation: expandDown 0.3s ease-out;
        }
        
        @keyframes expandDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                max-height: 500px;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 3px;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 11px;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-radius: 3px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-radius: 3px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            max-width: 66.66%;
        }

        .input-container {
            padding: 8px 12px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 6px;
        }

        #userInput {
            flex: 1;
            padding: 6px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 3px;
            font-size: 11px;
            outline: none;
            transition: border-color 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            padding: 6px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #sendBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #sendBtn:active {
            transform: translateY(0);
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Tlaƒç√≠tko stopky pro p≈ôeskoƒçen√≠ typing efektu */
        #skipTypingBtn {
            padding: 6px 10px;
            background: transparent;
            color: #999;
            border: none;
            border-radius: 3px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: none;
            align-items: center;
            justify-content: center;
        }

        #skipTypingBtn.active {
            display: flex;
        }

        #skipTypingBtn:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.1);
        }

        #skipTypingBtn:active {
            transform: scale(0.95);
        }

        .typing-indicator {
            display: none;
            padding: 12px 18px;
            background: white;
            border-radius: 18px;
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator.active {
            display: block;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .footer {
            padding: 6px 12px;
            text-align: center;
            font-size: 7px;
            color: #999;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .footer-content {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .footer-logo {
            height: 18px;
            width: auto;
            opacity: 0.8;
        }

        .contact-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            margin-top: 0;
            padding: 10px 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 9px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            white-space: nowrap;
            flex: 1;
            min-width: 80px;
            position: relative;
            overflow: hidden;
        }
        
        .contact-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .contact-btn:hover::before {
            left: 100%;
        }

        .contact-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        .contact-btn:active {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }
        
        .btn-icon {
            font-size: 18px;
            line-height: 1;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }
        
        .btn-text {
            font-size: 9px;
            font-weight: 600;
            letter-spacing: 0.3px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* Modal styly */
        .modal {
            display: none;
            position: fixed;
            z-index: 999999 !important;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-in;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 400px;
            max-width: 90%;
            max-height: 500px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            position: relative;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            z-index: 999999 !important;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 18px;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-body {
            color: #333;
            font-size: 13px;
            line-height: 1.6;
        }

        .modal-body h3 {
            color: #667eea;
            font-size: 15px;
            margin: 12px 0 6px 0;
        }

        .modal-body p {
            margin: 8px 0;
        }

        .modal-body a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s;
        }

        .modal-body a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        /* Styly pro sekce v modalu Ostatn√≠ */
        .info-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .info-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .info-link-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none !important;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            min-height: 48px;
        }

        .info-link-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .info-link-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }

        .contact-links {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .contact-link {
            display: block;
            padding: 10px 14px;
            background: transparent;
            color: #667eea;
            text-decoration: none;
            border: 1.5px solid #667eea;
            border-radius: 6px;
            text-align: center;
            transition: all 0.3s;
            font-size: 13px;
        }

        .contact-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }

        /* Styly pro p≈ôedmƒõtov√© tlaƒç√≠tka */
        .predmet-btn {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            background: transparent;
            color: #667eea;
            text-decoration: none;
            border: 2px solid #667eea;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .predmet-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .predmety-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        /* Styly pro tlaƒç√≠tka t≈ô√≠d (ƒçtvercov√°) */
        .tridy-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 5px;
            align-items: center;
        }

        .trida-btn {
            padding: 4px;
            background: transparent;
            color: #667eea;
            border: 1px solid #667eea;
            border-radius: 3px;
            font-size: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-width: 22px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .trida-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .trida-btn:active {
            transform: translateY(0);
        }

        /* Tooltip styly pro p≈ôedmƒõty */
        .trida-btn[title] {
            position: relative;
        }

        .trida-btn[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            padding: 6px 10px;
            background: #333;
            color: white;
            font-size: 11px;
            white-space: nowrap;
            border-radius: 4px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            animation: tooltipFadeIn 0.3s ease-in forwards;
        }

        .trida-btn[title]:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: -1px;
            border: 5px solid transparent;
            border-top-color: #333;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            animation: tooltipFadeIn 0.3s ease-in forwards;
        }

        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* ===== PLOVOUC√ç TLAƒå√çTKO PRO OTEV≈òEN√ç CHATBOTA ===== */
        
        .chat-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.6);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .chat-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(102, 126, 234, 0.8);
        }

        .chat-toggle-btn:active {
            transform: scale(0.95);
        }

        /* Animace pro puls efekt */
        @keyframes pulse {
            0% {
                box-shadow: 0 2px 10px rgba(102, 126, 234, 0.6);
            }
            50% {
                box-shadow: 0 2px 15px rgba(102, 126, 234, 0.9), 0 0 0 5px rgba(102, 126, 234, 0.1);
            }
            100% {
                box-shadow: 0 2px 10px rgba(102, 126, 234, 0.6);
            }
        }

        .chat-toggle-btn.pulse {
            animation: pulse 2s infinite;
        }

        /* Skryt√≠/zobrazen√≠ chatbota */
        .container.hidden {
            transform: translateY(600px);
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .container {
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Rotace ikony tlaƒç√≠tka */
        .chat-toggle-btn .icon {
            transition: transform 0.3s ease;
        }

        .chat-toggle-btn.active .icon {
            transform: rotate(180deg);
        }

        /* Badge upozornƒõn√≠ na aktivn√≠ chat */
        .chat-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 68, 68, 0.6);
            animation: badgePulse 2s infinite;
            z-index: 1000;
        }

        .chat-badge.show {
            display: flex;
        }

        @keyframes badgePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        /* ===== UV√çTAC√ç BUBLINA ===== */
        .welcome-bubble {
            position: fixed;
            bottom: 95px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 20px 20px 5px 20px;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
            max-width: 280px;
            z-index: 998;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            pointer-events: none;
        }

        .welcome-bubble.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
            animation: bubbleBounce 2s ease-in-out 0.5s infinite;
        }

        .welcome-bubble-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .welcome-bubble-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .welcome-bubble-text {
            flex: 1;
        }

        .welcome-bubble-title {
            font-size: 14px;
            font-weight: bold;
            margin: 0 0 4px 0;
        }

        .welcome-bubble-message {
            font-size: 12px;
            margin: 0;
            opacity: 0.95;
            line-height: 1.4;
        }

        .welcome-bubble-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .welcome-bubble-close:hover {
            opacity: 1;
        }

        @keyframes bubbleSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bubbleBounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        /* ===== RESPONZIVN√ç DESIGN PRO TABLET A MOBIL ===== */
        
        /* Tablet - landscape (1024px a m√©nƒõ) */
        @media screen and (max-width: 1024px) {
            .container {
                width: 380px;
                height: 550px;
                bottom: 15px;
                right: 15px;
            }

            .chat-toggle-btn {
                width: 64px;
                height: 64px;
                font-size: 30px;
                bottom: 15px;
                right: 15px;
            }
        }

        /* Tablet - portrait (768px a m√©nƒõ) */
        @media screen and (max-width: 768px) {
            .container {
                position: fixed;
                bottom: 0;
                right: 5%;
                left: 5%;
                top: auto;
                width: 90%;
                height: 70vh;
                max-height: 600px;
                border-radius: 20px 20px 0 0;
                margin: 0;
            }

            /* Tlaƒç√≠tka rychl√© volby pro tablet */
            .quick-buttons-fixed {
                padding: 8px 6%;
                gap: 4px;
            }

            .contact-btn {
                padding: 5px 6px;
                font-size: 9px;
                min-width: 65px;
            }

            /* Modal pro mobiln√≠ za≈ô√≠zen√≠ - MUS√ç b√Ωt viditeln√Ω p≈ôes chatbot */
            .modal {
                z-index: 999999 !important;
            }

            .modal-content {
                width: 90%;
                max-width: none;
                max-height: 70vh;
                margin: 10% auto;
                font-size: 14px;
                z-index: 999999 !important;
            }

            .modal-body {
                font-size: 14px;
            }

            .modal-body h3 {
                font-size: 16px;
            }

            /* Responzivn√≠ button-grid pro tablet */
            .button-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 8px;
            }

            .info-link-btn {
                font-size: 12px;
                padding: 10px 12px;
                min-height: 44px;
            }

            .modal-header h2 {
                font-size: 20px;
            }

            .close-btn {
                font-size: 28px;
                width: 28px;
                height: 28px;
            }

            .contact-link {
                font-size: 14px;
                padding: 12px 16px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header p {
                font-size: 10px;
            }

            .quick-buttons-fixed {
                padding: 10px 16px 14px 16px;
            }

            .quick-action-btn {
                font-size: 12px;
                padding: 9px 16px;
            }

            .send-button {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }

            .input-container input {
                font-size: 15px;
                padding: 12px 15px;
            }

            .chat-toggle-btn {
                width: 70px;
                height: 70px;
                font-size: 32px;
                bottom: 20px;
                right: 20px;
            }

            .container.hidden {
                transform: translateY(100vh);
            }
        }

        /* Mobil - velk√Ω (480px a m√©nƒõ) */
        @media screen and (max-width: 480px) {
            .container {
                left: 5%;
                right: 5%;
                width: 90%;
                height: 75vh;
                max-height: none;
                border-radius: 15px 15px 0 0;
            }

            /* Tlaƒç√≠tka rychl√© volby pro mobil */
            .quick-buttons-fixed {
                padding: 6px 7%;
                gap: 3px;
            }

            .contact-btn {
                padding: 5px 6px;
                font-size: 9px;
                min-width: 65px;
                border-radius: 4px;
            }

            /* Modal pro mal√© mobiln√≠ za≈ô√≠zen√≠ */
            .modal {
                z-index: 999999 !important;
            }

            .modal-content {
                width: 95%;
                max-width: none;
                max-height: 75vh;
                margin: 8% auto;
                padding: 16px;
                font-size: 14px;
                z-index: 999999 !important;
            }

            .modal-body {
                font-size: 14px;
            }

            .modal-body h3 {
                font-size: 16px;
            }

            /* Responzivn√≠ button-grid pro mobil */
            .button-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .info-link-btn {
                font-size: 13px;
                padding: 12px 14px;
                min-height: 48px;
            }

            .modal-header h2 {
                font-size: 20px;
            }

            .close-btn {
                font-size: 30px;
                width: 30px;
                height: 30px;
            }

            .contact-link {
                font-size: 15px;
                padding: 14px 18px;
            }

            .header {
                padding: 12px 16px;
            }

            .header h1 {
                font-size: 18px;
            }

            .header p {
                font-size: 9px;
            }

            .chat-container {
                padding: 12px;
            }

            .quick-buttons-fixed {
                padding: 8px 12px 12px 12px;
                margin: 0 -12px 8px -12px;
                gap: 6px;
            }

            .quick-action-btn {
                font-size: 10px;
                padding: 7px 12px;
                border-radius: 15px;
            }

            .message-content {
                max-width: 85%;
                font-size: 13px;
                padding: 10px 12px;
            }

            .input-container {
                padding: 10px;
                gap: 8px;
            }

            .input-container input {
                font-size: 14px;
                padding: 10px 12px;
            }

            .send-button {
                width: 42px;
                height: 42px;
                font-size: 18px;
            }

            .chat-toggle-btn {
                width: 60px;
                height: 60px;
                font-size: 28px;
                bottom: 15px;
                right: 15px;
            }

            /* P≈ôedmƒõty - responsive grid */
            .predmety-grid {
                gap: 6px;
            }

            .predmet-btn {
                font-size: 10px;
                padding: 8px;
            }
        }

        /* Mobil - mal√Ω (360px a m√©nƒõ) */
        @media screen and (max-width: 360px) {
            .container {
                left: 5%;
                right: 5%;
                width: 90%;
                height: 80vh;
            }

            /* Tlaƒç√≠tka rychl√© volby pro mal√Ω mobil */
            .quick-buttons-fixed {
                padding: 5px 8%;
                gap: 2px;
                flex-wrap: wrap;
            }

            .contact-btn {
                padding: 5px 6px;
                font-size: 9px;
                min-width: 65px;
                border-radius: 3px;
            }

            .modal-content {
                width: 96%;
                max-height: 80vh;
                margin: 5% auto;
                padding: 14px;
            }

            .modal-body {
                font-size: 13px;
            }

            .modal-body h3 {
                font-size: 15px;
            }

            /* Responzivn√≠ button-grid pro mal√Ω mobil */
            .button-grid {
                grid-template-columns: 1fr;
                gap: 6px;
            }

            .info-link-btn {
                font-size: 12px;
                padding: 10px 12px;
                min-height: 44px;
            }

            .modal-header h2 {
                font-size: 18px;
            }

            .contact-link {
                font-size: 14px;
                padding: 12px 16px;
            }

            .header h1 {
                font-size: 16px;
            }

            .header p {
                font-size: 8px;
            }

            .quick-action-btn {
                font-size: 9px;
                padding: 6px 10px;
            }

            .message-content {
                font-size: 12px;
                padding: 8px 10px;
            }

            .input-container input {
                font-size: 13px;
                padding: 9px 11px;
            }

            .send-button {
                width: 38px;
                height: 38px;
                font-size: 16px;
            }
        }

        /* Orientace na ≈°√≠≈ôku (landscape) na mobilu */
        @media screen and (max-width: 768px) and (orientation: landscape) {
            .container {
                height: 85vh;
                max-height: none;
            }

            .chat-container {
                padding: 10px;
            }

            .header {
                padding: 8px 16px;
            }

            .header h1 {
                font-size: 16px;
            }

            .header p {
                font-size: 8px;
            }
        }

        /* Touch-friendly √∫pravy pro v≈°echna dotykov√© za≈ô√≠zen√≠ */
        @media (hover: none) and (pointer: coarse) {
            .quick-action-btn,
            .trida-btn,
            .predmet-btn,
            .send-button {
                min-height: 44px;
                min-width: 44px;
            }

            .quick-action-btn:active,
            .trida-btn:active,
            .predmet-btn:active {
                transform: scale(0.95);
                opacity: 0.8;
            }

            .send-button:active {
                transform: scale(0.9);
            }

            /* Vƒõt≈°√≠ scrollbar pro touch */
            .chat-container::-webkit-scrollbar {
                width: 8px;
            }

            .chat-container::-webkit-scrollbar-thumb {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 4px;
            }
        }
    </style>
</head>
<body>
    <!-- Plovouc√≠ tlaƒç√≠tko pro otev≈ôen√≠/zav≈ôen√≠ chatbota -->
    <button class="chat-toggle-btn pulse" id="chatToggleBtn" onclick="toggleChat()">
        <span class="icon">üí¨</span>
        <span class="chat-badge" id="chatBadge">!</span>
    </button>

    <!-- Uv√≠tac√≠ bublina -->
    <div class="welcome-bubble" id="welcomeBubble">
        <button class="welcome-bubble-close" onclick="closeWelcomeBubble()" title="Zav≈ô√≠t">&times;</button>
        <div class="welcome-bubble-content">
            <div class="welcome-bubble-icon">üëã</div>
            <div class="welcome-bubble-text">
                <p class="welcome-bubble-title">Ahoj! Jsem MATIƒå√ÅK</p>
                <p class="welcome-bubble-message">Jsem tady, abych ti pomohl s informacemi o ≈°kole. Klikni na mƒõ! üöÄ</p>
            </div>
        </div>
    </div>

    <div class="container hidden" id="chatWidget">
        <div class="header">
            <h1>ü§ñ MATIƒå√ÅK</h1>
            <p>Matiƒçn√≠ AI Pomocn√≠k</p>
            <button class="header-close-btn" onclick="toggleChat()" title="Zav≈ô√≠t">‚àí</button>
            <!-- ≈òeƒçov√° bublina NOV√â v hlaviƒçce -->
            <div class="novinka-badge" id="novinkaBadge" onclick="showAnnouncementModal()" title="Klikni pro v√≠ce informac√≠">
                <span class="novinka-icon">üìã</span>
                <span class="novinka-text">NOV√â</span>
            </div>
        </div>
        
        <div class="quick-buttons-fixed" id="quickButtonsFixed">
            <button class="contact-btn" onclick="showContact()">
                <span class="btn-icon">üìß</span>
                <span class="btn-text">Kontakt</span>
            </button>
            <button class="contact-btn" onclick="showJidelna()">
                <span class="btn-icon">üçΩÔ∏è</span>
                <span class="btn-text">J√≠delna</span>
            </button>
            <button class="contact-btn" onclick="showRozvrh()">
                <span class="btn-icon">üìÖ</span>
                <span class="btn-text">Rozvrh</span>
            </button>
            <button class="contact-btn" onclick="showOstatni()">
                <span class="btn-icon">üìã</span>
                <span class="btn-text">Ostatn√≠</span>
            </button>
        </div>
        
        <div class="chat-container" id="chatContainer">
        </div>
        
        <div class="input-container">
            <input 
                type="text" 
                id="userInput" 
                placeholder="Napi≈° svou zpr√°vu..." 
                autocomplete="off"
            >
            <button id="skipTypingBtn" onclick="skipCurrentTyping()" title="Zobrazit cel√Ω text okam≈æitƒõ">‚è©</button>
            <button id="sendBtn">Odeslat</button>
        </div>
        
        <div class="footer">
            <div class="footer-content">
                <img src="logo_mgo.jpeg" alt="MGO Logo" class="footer-logo">
                <span>Vytvo≈ôili ≈æ√°ci Matiƒçn√≠ho gymn√°zia Ostrava</span>
            </div>
        </div>

        <!-- Modal okno pro kontakt -->
        <div id="contactModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìß Kontakt</h2>
                    <button class="close-btn" onclick="closeContactModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <h3>Matiƒçn√≠ gymn√°zium Ostrava</h3>
                    <p><strong>üìß E-mail:</strong> <a href="mailto:info@mgo.cz">info@mgo.cz</a></p>
                    
                    <h3>Sekretari√°t</h3>
                    <p><strong>üë§ ≈†kopkov√° Yvona</strong></p>
                    <p><strong>üìû Telefon:</strong> <a href="tel:+420596116239">+420 596 11 62 39</a></p>
                    <p><strong>üìù Kontaktn√≠ formul√°≈ô:</strong> <a href="https://mgo.cz/jj/kontakty/vedeni-a-sprava-skoly/6-zajacovvona.html" target="_blank">Otev≈ô√≠t formul√°≈ô</a></p>
                    
                    <div class="contact-links">
                        <a href="#" onclick="showVedeniInfo(event)" class="contact-link">
                            üëî Veden√≠ ≈°koly
                        </a>
                        <a href="#" onclick="showUciteleModalWindow(event)" class="contact-link">
                            üë®‚Äçüè´ Uƒçitel√©
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal okno pro j√≠delnu -->
        <div id="jidelnaModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üçΩÔ∏è J√≠delna</h2>
                    <button class="close-btn" onclick="closeJidelnaModal()">&times;</button>
                </div>
                <div class="modal-body" id="jidelnaModalBody">
                    <p>‚è≥ Naƒç√≠t√°m informace o j√≠delnƒõ...</p>
                </div>
            </div>
        </div>

        <!-- Modal okno pro rozvrh -->
        <div id="rozvrhModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìÖ Rozvrh</h2>
                    <button class="close-btn" onclick="closeRozvrhModal()">&times;</button>
                </div>
                <div class="modal-body" id="rozvrhModalBody">
                    <h3>Vyber t≈ô√≠du:</h3>
                    
                    <h4 style="color: #764ba2; font-size: 14px; margin: 15px 0 8px 0;">üìö Prvn√≠ stupe≈à</h4>
                    <div class="tridy-grid" style="gap: 8px;">
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhPA()">PA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhPB()">PB</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhSA()">SA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhSB()">SB</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhTA()">TA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhTB()">TB</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhKVA()">KVA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhKVB()">KVB</button>
                    </div>
                    
                    <h4 style="color: #764ba2; font-size: 14px; margin: 15px 0 8px 0;">üéì Druh√Ω stupe≈à</h4>
                    <div class="tridy-grid" style="gap: 8px;">
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrh1A()">1.A</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhKVIA()">KVIA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhKVIB()">KVIB</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrh2A()">2.A</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhSXA()">SXA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhSXB()">SXB</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrh3A()">3.A</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhSPTA()">SPTA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhSPTB()">SPTB</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrh4A()">4.A</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhOKTA()">OKTA</button>
                        <button class="trida-btn" style="font-size: 13px; min-width: 50px; height: 40px; padding: 8px;" onclick="showRozvrhOKTB()">OKTB</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal okno pro uƒçitele -->
        <div id="uciteleModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üë®‚Äçüè´ Uƒçitel√©</h2>
                    <button class="close-btn" onclick="closeUciteleModal()">&times;</button>
                </div>
                <div class="modal-body" id="uciteleModalBody">
                    <h3>Vyber p≈ôedmƒõt:</h3>
                    
                    <h4 style="color: #764ba2; font-size: 14px; margin: 15px 0 8px 0;">üìö Jazyky</h4>
                    <div class="tridy-grid" style="gap: 8px;">
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="ƒåesk√Ω jazyk" onclick="showUciteleByPredmetModal('ƒåesk√Ω jazyk', 'ƒåj')">ƒåj</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Angliƒçtina" onclick="showUciteleByPredmetModal('Angliƒçtina', 'Aj')">Aj</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Nƒõmƒçina" onclick="showUciteleByPredmetModal('Nƒõmƒçina', 'Nj')">Nj</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="≈†panƒõl≈°tina" onclick="showUciteleByPredmetModal('≈†panƒõl≈°tina', '≈†j')">≈†j</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Francouz≈°tina" onclick="showUciteleByPredmetModal('Francouz≈°tina', 'Fj')">Fj</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Ru≈°tina" onclick="showUciteleByPredmetModal('Ru≈°tina', 'Rj')">Rj</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Latina" onclick="showUciteleByPredmetModal('Latina', 'La')">La</button>
                    </div>
                    
                    <h4 style="color: #764ba2; font-size: 14px; margin: 15px 0 8px 0;">üî¨ P≈ô√≠rodn√≠ vƒõdy</h4>
                    <div class="tridy-grid" style="gap: 8px;">
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Matematika" onclick="showUciteleByPredmetModal('Matematika', 'M')">M</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Fyzika" onclick="showUciteleByPredmetModal('Fyzika', 'F')">F</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Chemie" onclick="showUciteleByPredmetModal('Chemie', 'Ch')">Ch</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Biologie" onclick="showUciteleByPredmetModal('Biologie', 'Bi')">Bi</button>
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Informatika" onclick="showUciteleByPredmetModal('Informatika', 'IVT')">IVT</button>
                    </div>
                    
                    <h4 style="color: #764ba2; font-size: 14px; margin: 15px 0 8px 0;">üåç Spoleƒçensk√© vƒõdy</h4>
                    <div class="tridy-grid" style="gap: 8px;">
                        <button class="trida-btn" style="font-size: 16px; min-width: 65px; height: 50px; padding: 10px;" title="Dƒõjepis" onclick="showUciteleByPredmetModal('Dƒõjepis', 'D')">D</button>
                        <button class="trida-btn" style="font-size: 12px; min-width: 55px; height: 40px; padding: 8px;" title="Zemƒõpis" onclick="showUciteleByPredmetModal('Zemƒõpis', 'Z')">Z</button>
                        <button class="trida-btn" style="font-size: 12px; min-width: 55px; height: 40px; padding: 8px;" title="Obƒçansk√° v√Ωchova" onclick="showUciteleByPredmetModal('Obƒçansk√° v√Ωchova', 'Ov')">Ov</button>
                        <button class="trida-btn" style="font-size: 12px; min-width: 55px; height: 40px; padding: 8px;" title="Z√°klady spoleƒçensk√Ωch vƒõd" onclick="showUciteleByPredmetModal('ZSV', 'ZSV')">ZSV</button>
                        <button class="trida-btn" style="font-size: 12px; min-width: 55px; height: 40px; padding: 8px;" title="Ekonomie" onclick="showUciteleByPredmetModal('EKS', 'EKS')">EKS</button>
                    </div>
                    
                    <h4 style="color: #764ba2; font-size: 14px; margin: 15px 0 8px 0;">üé® Umƒõn√≠ a sport</h4>
                    <div class="tridy-grid" style="gap: 8px;">
                        <button class="trida-btn" style="font-size: 12px; min-width: 55px; height: 40px; padding: 8px;" title="Tƒõlesn√° v√Ωchova" onclick="showUciteleByPredmetModal('Tƒõlesn√° v√Ωchova', 'Tv')">Tv</button>
                        <button class="trida-btn" style="font-size: 12px; min-width: 55px; height: 40px; padding: 8px;" title="Hudebn√≠ v√Ωchova" onclick="showUciteleByPredmetModal('Hudebn√≠ v√Ωchova', 'Hv')">Hv</button>
                        <button class="trida-btn" style="font-size: 12px; min-width: 55px; height: 40px; padding: 8px;" title="V√Ωtvarn√° v√Ωchova" onclick="showUciteleByPredmetModal('V√Ωtvarn√° v√Ωchova', 'Vv')">Vv</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal okno pro NOV√â - Aktu√°ln√≠ novinky -->
        <div id="novinkaModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative; overflow: hidden; padding: 20px;">
                    <!-- Dekorativn√≠ kruhy v pozad√≠ -->
                    <div style="position: absolute; top: -50%; right: -10%; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);"></div>
                    <div style="position: absolute; bottom: -30%; left: -5%; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(30px);"></div>
                    
                    <h2 style="color: white; position: relative; z-index: 1; display: flex; align-items: center; gap: 12px; font-weight: 700; letter-spacing: 0.5px; margin: 0; font-size: 22px;">
                        <span style="font-size: 32px; animation: bounce 2s ease-in-out infinite;">üîî</span>
                        <span>Aktu√°ln√≠ novinky</span>
                    </h2>
                    <button class="close-btn" onclick="closeNovinkaModal()" style="color: white; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); z-index: 2; background: rgba(255,255,255,0.2); border: none; border-radius: 50%; width: 32px; height: 32px; font-size: 24px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-50%) rotate(90deg)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(-50%) rotate(0deg)'">&times;</button>
                </div>
                <div class="modal-body" id="novinkyModalBody" style="padding: 20px; max-height: 60vh; overflow-y: auto;">
                    <!-- Novinky se naƒçtou dynamicky -->
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <p>‚è≥ Naƒç√≠t√°m novinky...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal okno pro ostatn√≠ -->
        <div id="ostatniModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìã Ostatn√≠ informace</h2>
                    <button class="close-btn" onclick="closeOstatniModal()">&times;</button>
                </div>
                <div class="modal-body" id="ostatniModalBody">
                    <!-- Sekce 1: Pro studenty -->
                    <div class="info-section">
                        <h3 style="color: #667eea; font-size: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            üìö Pro studenty
                        </h3>
                        <div class="button-grid">
                            <a href="https://mgo.bakalari.cz/bakaweb/next/zmeny.aspx" target="_blank" class="info-link-btn">
                                üîÑ Suplov√°n√≠
                            </a>
                            <a href="https://mgo.cz/data/Organizace_skolniho_roku%20_2025_26.pdf" target="_blank" class="info-link-btn">
                                üìÖ Org. ≈°koln√≠ho roku
                            </a>
                            <a href="https://mgo.cz/jj/studium/zvoneni.html" target="_blank" class="info-link-btn">
                                üîî Zvonƒõn√≠
                            </a>
                            <a href="https://mgo.cz/jj/studium/rozmisteni-trid.html" target="_blank" class="info-link-btn">
                                üó∫Ô∏è Rozm√≠stƒõn√≠ t≈ô√≠d
                            </a>
                            <a href="https://mgo.cz/jj/studium/maturitni-zkouska.html" target="_blank" class="info-link-btn">
                                üéì Maturitn√≠ zkou≈°ka
                            </a>
                        </div>
                    </div>

                    <!-- Sekce 2: Slu≈æby ≈°koly -->
                    <div class="info-section">
                        <h3 style="color: #667eea; font-size: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            üìñ Slu≈æby ≈°koly
                        </h3>
                        <div class="button-grid">
                            <a href="https://mgo.cz/jj/studium/skolni-knihovna.html" target="_blank" class="info-link-btn">
                                üìö ≈†koln√≠ knihovna
                            </a>
                            <a href="https://mgo.cz/jj/studium/skolni-poradenske-pracoviste.html" target="_blank" class="info-link-btn">
                                üí¨ Poradenstv√≠
                            </a>
                            <a href="https://www.nntb.cz/" target="_blank" class="info-link-btn">
                                üìÆ Schr√°nka d≈Øvƒõry
                            </a>
                            <a href="https://mgo.cz/jj/studium/studentske-tiskove-centrum.html" target="_blank" class="info-link-btn">
                                üñ®Ô∏è Tiskov√© centrum
                            </a>
                        </div>
                    </div>

                    <!-- Sekce 3: Krou≈æky a aktivity -->
                    <div class="info-section">
                        <h3 style="color: #667eea; font-size: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            üéØ Krou≈æky a aktivity
                        </h3>
                        <div class="button-grid">
                            <a href="https://mgo.cz/jj/zajmove-krouzky.html" target="_blank" class="info-link-btn">
                                üé® Z√°jmov√© krou≈æky
                            </a>
                            <a href="https://mgo.cz/jj/o-skole/aktivity-studentu.html" target="_blank" class="info-link-btn">
                                ‚ö° Aktivity student≈Ø
                            </a>
                            <a href="https://mgo.cz/jj/o-skole/erasmus.html" target="_blank" class="info-link-btn">
                                üåç Erasmus+
                            </a>
                            <a href="https://mgo.cz/jj/o-skole/spoluprace-a-projekty/dofe-na-mgo.html" target="_blank" class="info-link-btn">
                                üèÜ DofE program
                            </a>
                        </div>
                    </div>

                    <!-- Sekce 4: O ≈°kole -->
                    <div class="info-section">
                        <h3 style="color: #667eea; font-size: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            üè´ O ≈°kole
                        </h3>
                        <div class="button-grid">
                            <a href="https://my.matterport.com/show/?m=WGv9Vtb5Nvf" target="_blank" class="info-link-btn">
                                üé• Virtu√°ln√≠ prohl√≠dka
                            </a>
                            <a href="https://mgo.cz/jj/o-skole.html" target="_blank" class="info-link-btn">
                                üìú Historie ≈°koly
                            </a>
                            <a href="https://mgo.cz/jj/o-skole/uspechy.html" target="_blank" class="info-link-btn">
                                üèÖ √öspƒõchy ≈æ√°k≈Ø
                            </a>
                        </div>
                    </div>

                    <!-- Sekce 5: U≈æiteƒçn√© odkazy -->
                    <div class="info-section">
                        <h3 style="color: #667eea; font-size: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            üîó U≈æiteƒçn√© odkazy
                        </h3>
                        <div class="button-grid">
                            <a href="https://mgo.cz/jj/studium/bakalari-navod.html" target="_blank" class="info-link-btn">
                                üìñ Bakal√°≈ôi - n√°vod
                            </a>
                            <a href="https://play.google.com/store/apps/details?id=cz.impire.bakalari.student&hl=cs" target="_blank" class="info-link-btn">
                                üì± Bakal√°≈ôi Android
                            </a>
                            <a href="https://mgo.cz/jj/studium/vysoke-skoly.html" target="_blank" class="info-link-btn">
                                üéì Vysok√© ≈°koly
                            </a>
                            <a href="https://mgo.cz/jj/studium/cambridge-esol-exam-preparation-centre.html" target="_blank" class="info-link-btn">
                                üá¨üáß Cambridge certifik√°ty
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fallback pro CONFIG, pokud config.js nen√≠ naƒçten
        if (typeof CONFIG === 'undefined') {
            window.CONFIG = {
                API_BASE_URL: window.location.origin
            };
        }
        
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        
        // Glob√°ln√≠ promƒõnn√© pro typing efekt
        let typingEnabled = true;
        let currentTypingElement = null;
        let currentFullText = '';
        let skipTyping = false;
        let activeTypingCount = 0; // Poƒç√≠tadlo aktivn√≠ch typing efekt≈Ø
        
        // Funkce pro p≈ôeskoƒçen√≠ typing efektu
        function skipCurrentTyping() {
            // Nastav√≠me p≈ô√≠znak pro p≈ôeskoƒçen√≠ v≈°ech typing efekt≈Ø
            skipTyping = true;
            
            // Pokud m√°me aktu√°ln√≠ typing element, dokonƒç√≠me ho okam≈æitƒõ
            if (currentTypingElement && currentFullText) {
                currentTypingElement.innerHTML = currentFullText;
            }
            
            // Vynulujeme poƒç√≠tadlo typing efekt≈Ø (v≈°echny budou ukonƒçeny)
            activeTypingCount = 0;
            
            // Skryjeme tlaƒç√≠tko stopky
            hideSkipButton();
            
            // Scrollujeme dol≈Ø
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ tlaƒç√≠tka stopky
        function showSkipButton() {
            const skipBtn = document.getElementById('skipTypingBtn');
            if (skipBtn) {
                skipBtn.classList.add('active');
            }
        }
        
        // Funkce pro skryt√≠ tlaƒç√≠tka stopky
        function hideSkipButton() {
            // Skryjeme tlaƒç√≠tko jen pokud nebƒõ≈æ√≠ ≈æ√°dn√Ω typing
            if (activeTypingCount <= 0) {
                const skipBtn = document.getElementById('skipTypingBtn');
                if (skipBtn) {
                    skipBtn.classList.remove('active');
                }
            }
        }
        
        // Funkce pro zobrazen√≠ kontaktu
        function showContact() {
            console.log('showContact called');
            document.getElementById('contactModal').style.display = 'block';
        }
        
        // Funkce pro zobrazen√≠ rozvrhu
        function showRozvrh() {
            console.log('showRozvrh called');
            // Otev≈ôeme modal s rozvrhem
            document.getElementById('rozvrhModal').style.display = 'block';
        }
        
        // Funkce pro zobrazen√≠ ostatn√≠
        function showOstatni() {
            console.log('showOstatni called');
            document.getElementById('ostatniModal').style.display = 'block';
        }
        
        // Funkce pro zobrazen√≠ j√≠delny - dne≈°n√≠ menu
        async function showJidelna() {
            console.log('=== showJidelna START ===');
            
            // Z√≠sk√°me reference na elementy
            const modal = document.getElementById('jidelnaModal');
            const modalBody = document.getElementById('jidelnaModalBody');
            
            console.log('Modal:', modal);
            console.log('ModalBody:', modalBody);
            console.log('CONFIG.API_BASE_URL:', CONFIG.API_BASE_URL);
            
            // Zobraz√≠me modal
            if (modal) {
                modal.style.display = 'block';
                console.log('Modal display set to block');
            }
            
            // Nastav√≠me loading text
            if (modalBody) {
                modalBody.innerHTML = '<p style="text-align: center; padding: 20px;">‚è≥ Naƒç√≠t√°m dne≈°n√≠ menu...</p>';
                console.log('Loading text set');
            }
            
            const url = `${CONFIG.API_BASE_URL}/jidelna/dnesni-menu`;
            console.log('Fetching from:', url);
            
            try {
                const response = await fetch(url);
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                const result = await response.json();
                console.log('Result:', result);
                
                if (!modalBody) {
                    console.error('ModalBody is null!');
                    return;
                }
                
                if (result.success && result.data) {
                    console.log('Building HTML content...');
                    
                    let htmlContent = `<h3 style="color: #667eea; font-size: 16px;">üçΩÔ∏è Dne≈°n√≠ menu - ${result.data.den} ${result.data.datum}</h3>`;
                    
                    if (result.data.menu && result.data.menu.length > 0) {
                        for (const jidlo of result.data.menu) {
                            htmlContent += `<p style="font-size: 14px;"><strong>${jidlo.typ}:</strong><br>${jidlo.nazev}</p>`;
                        }
                    } else {
                        htmlContent += '<p style="font-size: 14px;">Dnes nen√≠ k dispozici ≈æ√°dn√© menu.</p>';
                    }
                    
                    htmlContent += '<div class="contact-links">';
                    htmlContent += '<a href="#" id="tydenniMenuLink" class="contact-link">üìÖ T√Ωdenn√≠ menu</a>';
                    htmlContent += '<a href="http://obedy.zs-mat5.cz/login" target="_blank" class="contact-link">üõí Objednat obƒõd</a>';
                    htmlContent += '</div>';
                    
                    console.log('Setting modalBody.innerHTML...');
                    modalBody.innerHTML = htmlContent;
                    console.log('HTML content set successfully');
                    
                    // Event listener pro t√Ωdenn√≠ menu
                    setTimeout(() => {
                        const tydenniLink = document.getElementById('tydenniMenuLink');
                        if (tydenniLink) {
                            console.log('Adding event listener to tydenniMenuLink');
                            const handleTydenniMenu = function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('T√Ωdenn√≠ menu clicked');
                                showTydenniMenuInChat(e);
                            };
                            
                            tydenniLink.addEventListener('click', handleTydenniMenu);
                            tydenniLink.addEventListener('touchstart', handleTydenniMenu, { passive: false });
                        }
                    }, 100);
                    
                } else {
                    console.log('No data in result');
                    modalBody.innerHTML = '<p style="color: red;">‚ùå Nepoda≈ôilo se naƒç√≠st dne≈°n√≠ menu.</p>';
                }
                
            } catch (error) {
                console.error('ERROR:', error);
                if (modalBody) {
                    modalBody.innerHTML = `
                        <p style="color: red;">‚ùå Do≈°lo k chybƒõ</p>
                        <p style="font-size: 10px;">${error.message}</p>
                        <p style="font-size: 10px;">URL: ${url}</p>
                    `;
                }
            }
            
            console.log('=== showJidelna END ===');
        }
        
        // Funkce pro zobrazen√≠ t√Ωdenn√≠ho menu v chatu
        async function showTydenniMenuInChat(event) {
            if (event) event.preventDefault();
            
            // Zav≈ôeme modal
            closeJidelnaModal();
            
            // Nejd≈ô√≠v zobraz√≠me zpr√°vu u≈æivatele
            addMessage('T√Ωdenn√≠ menu', true);
            
            // Zobraz√≠me loading zpr√°vu v chatu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'tydenniMenuLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            loadingContent.textContent = '‚è≥ Naƒç√≠t√°m t√Ωdenn√≠ menu...';
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/jidelna/tydenni-menu`);
                const result = await response.json();
                
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('tydenniMenuLoading');
                if (loading) loading.remove();
                
                if (result.success && result.data) {
                    // Vytvo≈ô√≠me form√°tovanou zpr√°vu s t√Ωdenn√≠m menu
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.style.maxWidth = '80%';
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    // Vytvo≈ô√≠me cel√Ω HTML obsah
                    let htmlContent = '<h3 style="color: #667eea; font-size: 13px; margin: 0 0 10px 0;">üìÖ T√Ωdenn√≠ j√≠deln√≠ l√≠stek</h3>';
                    
                    if (result.data.dny && result.data.dny.length > 0) {
                        for (const den of result.data.dny) {
                            htmlContent += `<h3 style="color: #667eea; font-size: 12px; margin: 10px 0 6px 0;">${den.den}</h3>`;
                            
                            for (const jidlo of den.menu) {
                                htmlContent += `<p style="margin: 5px 0; font-size: 11px;"><strong>${jidlo.typ}:</strong><br>${jidlo.nazev}</p>`;
                            }
                        }
                        
                        htmlContent += '<p style="margin-top: 10px; font-style: italic; font-size: 10px;">üí° Pro objedn√°n√≠ nav≈°tivte: <a href="http://obedy.zs-mat5.cz/login" target="_blank" style="color: #667eea; text-decoration: none;">obedy.zs-mat5.cz</a></p>';
                    } else {
                        htmlContent += '<p style="font-size: 11px;">T√Ωdenn√≠ menu nen√≠ k dispozici.</p>';
                    }
                    
                    // Pou≈æijeme typing efekt pro cel√Ω obsah najednou
                    await typeHtmlMessage(contentDiv, htmlContent, 1);
                } else {
                    addMessage('‚ùå Nepoda≈ôilo se naƒç√≠st t√Ωdenn√≠ menu. Zkus to pros√≠m pozdƒõji.', false);
                }
                
            } catch (error) {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('tydenniMenuLoading');
                if (loading) loading.remove();
                
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ t√Ωdenn√≠ho menu:', error);
                addMessage('‚ùå Do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ t√Ωdenn√≠ho menu. Zkus to pros√≠m znovu.', false);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zav≈ôen√≠ modalu
        function closeContactModal() {
            document.getElementById('contactModal').style.display = 'none';
        }
        
        // Funkce pro zav≈ôen√≠ j√≠delna modalu
        function closeJidelnaModal() {
            document.getElementById('jidelnaModal').style.display = 'none';
        }
        
        // Funkce pro zav≈ôen√≠ rozvrh modalu
        function closeRozvrhModal() {
            document.getElementById('rozvrhModal').style.display = 'none';
        }
        
        // Funkce pro zav≈ôen√≠ uƒçitele modalu
        function closeUciteleModal() {
            document.getElementById('uciteleModal').style.display = 'none';
        }
        
        // Funkce pro zav≈ôen√≠ ostatn√≠ modalu
        function closeOstatniModal() {
            document.getElementById('ostatniModal').style.display = 'none';
        }
        
        // ===== FUNKCE PRO SEKCE V OSTATN√ç MODALU =====
        
        // Funkce pro zobrazen√≠ ud√°lost√≠
        async function showUdalosti(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">üéâ Nadch√°zej√≠c√≠ ud√°losti</h3>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üìÖ 15. prosince 2025</strong><br>V√°noƒçn√≠ akademie - slavnostn√≠ program</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üìÖ 20. prosince 2025</strong><br>Posledn√≠ vyuƒçovac√≠ den p≈ôed pr√°zdninami</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üìÖ 5. ledna 2026</strong><br>Prvn√≠ vyuƒçovac√≠ den po pr√°zdnin√°ch</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üìÖ Leden 2026</strong><br>Matiƒçn√≠ ples</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° Aktu√°ln√≠ kalend√°≈ô akc√≠ najde≈° na webu ≈°koly</p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ pr√°zdnin
        async function showPrazdniny(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">üèñÔ∏è Pr√°zdniny ≈°koln√≠ho roku 2025/2026</h3>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üçÇ Podzimn√≠ pr√°zdniny:</strong><br>27.-29. ≈ô√≠jna 2025</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üéÑ V√°noƒçn√≠ pr√°zdniny:</strong><br>22. prosince 2025 - 4. ledna 2026</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üìö Pololetn√≠ pr√°zdniny:</strong><br>30. ledna 2026</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üå∏ Jarn√≠ pr√°zdniny:</strong><br>9.-15. b≈ôezna 2026</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>üê∞ Velikonoƒçn√≠ pr√°zdniny:</strong><br>2.-3. dubna 2026</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>‚òÄÔ∏è Hlavn√≠ pr√°zdniny:</strong><br>1. ƒçervence - 31. srpna 2026</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° Dal≈°√≠ voln√© dny a ≈ôeditelsk√© volno najde≈° v dokumentu Organizace ≈°koln√≠ho roku</p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ ≈°koln√≠ho ≈ô√°du
        async function showSkolniRad(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">üìñ ≈†koln√≠ ≈ô√°d</h3>
                <p style="margin: 5px 0; font-size: 10px;">≈†koln√≠ ≈ô√°d upravuje pr√°va a povinnosti ≈æ√°k≈Ø, pravidla chov√°n√≠ ve ≈°kole, doch√°zku, hodnocen√≠ a dal≈°√≠ organizaƒçn√≠ z√°le≈æitosti.</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>Hlavn√≠ body:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Doch√°zka a omlouv√°n√≠ absence</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Pr√°va a povinnosti ≈æ√°k≈Ø</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Pravidla chov√°n√≠</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Hodnocen√≠ a klasifikace</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Bezpeƒçnost a ochrana zdrav√≠</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° Kompletn√≠ ≈°koln√≠ ≈ô√°d najde≈° na <a href="https://mgo.cz" target="_blank" style="color: #667eea;">webu ≈°koly</a></p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ organizace ≈°koln√≠ho roku
        async function showOrganizace(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">üìã Organizace ≈°koln√≠ho roku 2025/2026</h3>
                <p style="margin: 5px 0; font-size: 10px;"><strong>Zaƒç√°tek ≈°koln√≠ho roku:</strong> 2. z√°≈ô√≠ 2025</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>Konec 1. pololet√≠:</strong> 31. ledna 2026</p>
                <p style="margin: 5px 0; font-size: 10px;"><strong>Konec ≈°koln√≠ho roku:</strong> 30. ƒçervna 2026</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>D≈Øle≈æit√© term√≠ny:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ T≈ô√≠dn√≠ sch≈Øzky - podzim/jaro</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Maturitn√≠ zkou≈°ky - kvƒõten/ƒçerven</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ P≈ôij√≠mac√≠ zkou≈°ky - duben</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° Detailn√≠ organizaci najde≈° v dokumentu na webu ≈°koly</p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ krou≈æk≈Ø
        async function showKrouzky(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">‚öΩ Krou≈æky a mimo≈°koln√≠ aktivity</h3>
                <p style="margin: 10px 0; font-size: 10px;"><strong>üé≠ Umƒõn√≠ a kultura:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Divadeln√≠ krou≈æek</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Hudebn√≠ krou≈æek</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ V√Ωtvarn√Ω krou≈æek</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>‚öΩ Sport:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Florbal</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Volejbal</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>üî¨ Vƒõda a technika:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Programov√°n√≠</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Robotika</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° V√≠ce informac√≠ z√≠sk√°≈° u t≈ô√≠dn√≠ho uƒçitele nebo na n√°stƒõnce</p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ Bakal√°≈ô≈Ø
        async function showBakalari(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">üíª Bakal√°≈ôi - Elektronick√° ≈æ√°kovsk√° kn√≠≈æka</h3>
                <p style="margin: 5px 0; font-size: 10px;">P≈ô√≠stup k elektronick√© ≈æ√°kovsk√© kn√≠≈æce, rozvrhu, zn√°mk√°m, dom√°c√≠m √∫kol≈Øm a komunikaci s uƒçiteli.</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>P≈ôihl√°≈°en√≠:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">üåê Web: <a href="https://bakalari.mgo.cz" target="_blank" style="color: #667eea;">bakalari.mgo.cz</a></p>
                <p style="margin: 5px 0; font-size: 9px;">üì± Mobiln√≠ aplikace: Bakal√°≈ôi OnLine</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>Funkce:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Rozvrh hodin</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Zn√°mky a hodnocen√≠</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Dom√°c√≠ √∫koly</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Absence a omluvenky</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Zpr√°vy od uƒçitel≈Ø</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° P≈ôihla≈°ovac√≠ √∫daje z√≠sk√°≈° u t≈ô√≠dn√≠ho uƒçitele</p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ knihovny
        async function showKnihovna(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">üìö ≈†koln√≠ knihovna</h3>
                <p style="margin: 5px 0; font-size: 10px;">≈†koln√≠ knihovna poskytuje ≈æ√°k≈Øm uƒçebnice, beletrii a odbornou literaturu.</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>Otev√≠rac√≠ doba:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">Pondƒõl√≠ - P√°tek: 7:30 - 15:00</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>Slu≈æby:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ P≈Øjƒçov√°n√≠ knih</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Studovna</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ P≈ô√≠stup k poƒç√≠taƒç≈Øm</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Kop√≠rov√°n√≠ a tisk</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° Kontakt na knihovnu najde≈° v sekci Kontakt</p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ dopravy
        async function showDoprava(event) {
            if (event) event.preventDefault();
            closeOstatniModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 11px; margin: 0 0 10px 0;">üöå Doprava a parkov√°n√≠</h3>
                <p style="margin: 10px 0; font-size: 10px;"><strong>üöå MHD:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">Nejbli≈æ≈°√≠ zast√°vka: Matiƒçn√≠ (tram 1, 2, 5, 6)</p>
                <p style="margin: 5px 0; font-size: 9px;">Autobus: linka 25, 31, 34</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>üöó Parkov√°n√≠:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Parkovi≈°tƒõ pro zamƒõstnance za ≈°kolou</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Parkovi≈°tƒõ pro n√°v≈°tƒõvy (omezen√Ω poƒçet m√≠st)</p>
                <p style="margin: 5px 0; font-size: 9px;">‚Ä¢ Modr√© z√≥ny v okol√≠ ≈°koly</p>
                <p style="margin: 10px 0; font-size: 10px;"><strong>üö≤ Kola:</strong></p>
                <p style="margin: 5px 0; font-size: 9px;">Stojany na kola p≈ôed ≈°kolou a na dvo≈ôe</p>
                <p style="margin-top: 10px; font-style: italic; font-size: 8px;">üí° ≈†koln√≠ dv≈Ør nen√≠ p≈ô√≠stupn√Ω pro ve≈ôejn√© parkov√°n√≠</p>
            `;
            
            contentDiv.innerHTML = htmlContent;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        

        // Zav≈ôen√≠ modalu p≈ôi kliknut√≠ mimo nƒõj
        window.onclick = function(event) {
            const contactModal = document.getElementById('contactModal');
            const jidelnaModal = document.getElementById('jidelnaModal');
            const rozvrhModal = document.getElementById('rozvrhModal');
            const uciteleModal = document.getElementById('uciteleModal');
            const ostatniModal = document.getElementById('ostatniModal');
            const novinkaModal = document.getElementById('novinkaModal');
            
            if (event.target === contactModal) {
                contactModal.style.display = 'none';
            }
            if (event.target === jidelnaModal) {
                jidelnaModal.style.display = 'none';
            }
            if (event.target === rozvrhModal) {
                rozvrhModal.style.display = 'none';
            }
            if (event.target === uciteleModal) {
                uciteleModal.style.display = 'none';
            }
            if (event.target === ostatniModal) {
                ostatniModal.style.display = 'none';
            }
            if (event.target === novinkaModal) {
                novinkaModal.style.display = 'none';
            }
        }
        
        // Zav≈ôen√≠ chatbota p≈ôi kliknut√≠ mimo nƒõj (zachov√° historii chatu)
        document.addEventListener('click', function(event) {
            const chatWidget = document.getElementById('chatWidget');
            const chatToggleBtn = document.getElementById('chatToggleBtn');
            const chatBadge = document.getElementById('chatBadge');
            
            // Pokud je chatbot otev≈ôen√Ω a kliknut√≠ nen√≠ uvnit≈ô chatbota ani na toggle tlaƒç√≠tku
            if (!chatWidget.classList.contains('hidden') && 
                !chatWidget.contains(event.target) && 
                !chatToggleBtn.contains(event.target)) {
                
                // Zav≈ôeme chatbot (historie z≈Østane zachov√°na, ikona tlaƒç√≠tka z≈Øst√°v√° stejn√°)
                chatWidget.classList.add('hidden');
                
                // Zobraz√≠me badge upozornƒõn√≠
                if (chatBadge) {
                    chatBadge.classList.add('show');
                }
            }
        });
        
        // Funkce pro zobrazen√≠ informac√≠ o veden√≠ ≈°koly
        async function showVedeniInfo(event) {
            event.preventDefault();
            closeContactModal();
            
            // Nejd≈ô√≠v zobraz√≠me zpr√°vu u≈æivatele
            addMessage('Veden√≠ ≈°koly', true);
            
            // Zobraz√≠me loading zpr√°vu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'vedeniLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            loadingContent.textContent = '‚è≥ Naƒç√≠t√°m informace o veden√≠ ≈°koly...';
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                // Naƒçteme data z backendu
                console.log('Naƒç√≠t√°m veden√≠ z:', `${CONFIG.API_BASE_URL}/kontakt/vedeni`);
                const response = await fetch(`${CONFIG.API_BASE_URL}/kontakt/vedeni`);
                console.log('Odpovƒõƒè serveru:', response.status);
                const result = await response.json();
                console.log('Data veden√≠:', result);
                
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('vedeniLoading');
                if (loading) loading.remove();
                
                if (result.success && result.data) {
                    // Vytvo≈ô√≠me form√°tovanou zpr√°vu s daty
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    // Vytvo≈ô√≠me HTML strukturu s klikac√≠mi odkazy
                    let htmlContent = "<strong>üëî Veden√≠ ≈°koly - Matiƒçn√≠ gymn√°zium Ostrava</strong><br><br>";
                    
                    result.data.forEach(osoba => {
                        htmlContent += `‚ñ™Ô∏è ${osoba.jmeno}<br>`;
                        htmlContent += `&nbsp;&nbsp;&nbsp;Pozice: ${osoba.pozice}<br>`;
                        if (osoba.email) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üìß Email: <a href="mailto:${osoba.email}" style="color: #667eea; text-decoration: none;">${osoba.email}</a><br>`;
                        }
                        if (osoba.telefon) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üìû Telefon: ${osoba.telefon}<br>`;
                        }
                        htmlContent += '<br>';
                    });
                    
                    // Zobraz√≠me s typing efektem
                    await typeHtmlMessage(contentDiv, htmlContent, 1);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                } else {
                    // Zobraz√≠me chybovou zpr√°vu okam≈æitƒõ
                    addMessage('Omlouv√°m se, nepoda≈ôilo se naƒç√≠st informace o veden√≠ ≈°koly. Zkus to pros√≠m pozdƒõji.', false);
                }
                
            } catch (error) {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('vedeniLoading');
                if (loading) loading.remove();
                
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ veden√≠:', error);
                addMessage(`‚ùå Do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ informac√≠.\n\nDebug: ${error.message}\nURL: ${CONFIG.API_BASE_URL}/kontakt/vedeni`, false);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ modalu s uƒçiteli
        function showUciteleModalWindow(event) {
            if (event) event.preventDefault();
            closeContactModal();
            document.getElementById('uciteleModal').style.display = 'block';
        }
        
        // Funkce pro zobrazen√≠ uƒçitel≈Ø z modalu (zav≈ôe modal a zobraz√≠ v chatu)
        async function showUciteleByPredmetModal(nazevPredmetu, idPredmetu) {
            console.log(`üîç showUciteleByPredmetModal vol√°no s: nazevPredmetu="${nazevPredmetu}", idPredmetu="${idPredmetu}"`);
            closeUciteleModal();
            await showUciteleByPredmet(nazevPredmetu, idPredmetu);
        }
        
        // Funkce pro zobrazen√≠ menu s p≈ôedmƒõty (p≈Øvodn√≠ - pro star√Ω zp≈Øsob)
        async function showUciteleMenu(event) {
            event.preventDefault();
            closeContactModal();
            
            // Vytvo≈ô√≠me zpr√°vu s tlaƒç√≠tky p≈ôedmƒõt≈Ø
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            // Typing efekt pro √∫vodn√≠ text
            await typeMessage(contentDiv, 'üë®‚Äçüè´ Vyber p≈ôedmƒõt pro zobrazen√≠ uƒçitel≈Ø:\n\n', 30);
            
            // P≈ôid√°me kontejner pro tlaƒç√≠tka p≈ôedmƒõt≈Ø
            const predmetyContainer = document.createElement('div');
            predmetyContainer.className = 'predmety-container';
            
            // Seznam p≈ôedmƒõt≈Ø z aprobac√≠ na https://mgo.cz/jj/kontakty/pedagogickysbor.html
            const predmety = [
                { nazev: 'Matematika', id: 'M' },
                { nazev: 'ƒåesk√Ω jazyk', id: 'ƒåj' },
                { nazev: 'Angliƒçtina', id: 'Aj' },
                { nazev: 'Nƒõmƒçina', id: 'Nj' },
                { nazev: '≈†panƒõl≈°tina', id: '≈†j' },
                { nazev: 'Francouz≈°tina', id: 'Fj' },
                { nazev: 'Ru≈°tina', id: 'Rj' },
                { nazev: 'Latina', id: 'La' },
                { nazev: 'Fyzika', id: 'F' },
                { nazev: 'Chemie', id: 'Ch' },
                { nazev: 'Biologie', id: 'Bi' },
                { nazev: 'Dƒõjepis', id: 'D' },
                { nazev: 'Zemƒõpis', id: 'Z' },
                { nazev: 'Informatika', id: 'IVT' },
                { nazev: 'Tƒõlesn√° v√Ωchova', id: 'Tv' },
                { nazev: 'Hudebn√≠ v√Ωchova', id: 'Hv' },
                { nazev: 'V√Ωtvarn√° v√Ωchova', id: 'Vv' },
                { nazev: 'Obƒçansk√° v√Ωchova', id: 'Ov' },
                { nazev: 'ZSV', id: 'ZSV' },
                { nazev: 'EKS', id: 'EKS' }
            ];
            
            // Vytvo≈ô√≠me tlaƒç√≠tko pro ka≈æd√Ω p≈ôedmƒõt
            predmety.forEach(predmet => {
                const btn = document.createElement('button');
                btn.className = 'predmet-btn';
                btn.textContent = predmet.nazev;
                btn.onclick = () => showUciteleByPredmet(predmet.nazev, predmet.id);
                predmetyContainer.appendChild(btn);
            });
            
            contentDiv.appendChild(predmetyContainer);
            
            // Scrollujeme jen kdy≈æ je pot≈ôeba
            if (chatContainer.scrollHeight > chatContainer.clientHeight) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }
        
        // Funkce pro zobrazen√≠ uƒçitel≈Ø dan√©ho p≈ôedmƒõtu
        async function showUciteleByPredmet(nazevPredmetu, idPredmetu) {
            // Nejd≈ô√≠v zobraz√≠me zpr√°vu u≈æivatele
            addMessage(`Uƒçitel√© - ${nazevPredmetu}`, true);
            
            // Zobraz√≠me loading zpr√°vu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'uciteleLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            loadingContent.textContent = `‚è≥ Naƒç√≠t√°m uƒçitele p≈ôedmƒõtu ${nazevPredmetu}...`;
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            
            // Scrollujeme k loading zpr√°vƒõ
            if (chatContainer.scrollHeight > chatContainer.clientHeight) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            try {
                // Naƒçteme data z backendu
                console.log(`üîç Naƒç√≠t√°m uƒçitele: nazevPredmetu="${nazevPredmetu}", idPredmetu="${idPredmetu}"`);
                const response = await fetch(`${CONFIG.API_BASE_URL}/kontakt/ucitele/${idPredmetu}`);
                const result = await response.json();
                console.log('üîç Backend response:', result);
                
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('uciteleLoading');
                if (loading) loading.remove();
                
                if (result.success && result.data && result.data.length > 0) {
                    // Vytvo≈ô√≠me form√°tovanou zpr√°vu s daty
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.style.maxWidth = '80%';
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    // Vytvo≈ô√≠me HTML strukturu s klikac√≠mi odkazy
                    let htmlContent = `<strong>üìö ${nazevPredmetu} - Vyuƒçuj√≠c√≠</strong><br><br>`;
                    
                    result.data.forEach(ucitel => {
                        htmlContent += `‚ñ™Ô∏è ${ucitel.jmeno}<br>`;
                        if (ucitel.aprobace) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;Aprobace: ${ucitel.aprobace}<br>`;
                        }
                        if (ucitel.klapka) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;‚òéÔ∏è Klapka: ${ucitel.klapka}<br>`;
                        }
                        if (ucitel.email) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üìß Email: <a href="mailto:${ucitel.email}" style="color: #667eea; text-decoration: none;">${ucitel.email}</a><br>`;
                        }
                        if (ucitel.konzultace) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üïê Konzultaƒçn√≠ hodiny: ${ucitel.konzultace}<br>`;
                        }
                        htmlContent += '<br>';
                    });
                    
                    // Zobraz√≠me s typing efektem
                    await typeHtmlMessage(contentDiv, htmlContent, 1);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                } else {
                    // Zobraz√≠me zpr√°vu, ≈æe nebyli nalezeni uƒçitel√©
                    addMessage(`üìö ${nazevPredmetu}\n\nBohu≈æel nebyly nalezeny ≈æ√°dn√© informace o uƒçitel√≠ch pro tento p≈ôedmƒõt.`, false);
                }
                
            } catch (error) {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('uciteleLoading');
                if (loading) loading.remove();
                
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ uƒçitel≈Ø:', error);
                addMessage('Omlouv√°m se, do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ informac√≠. Zkus to pros√≠m znovu.', false);
            }
        }
        
        // Funkce pro zobrazen√≠ st√°l√©ho rozvrhu v chatu
        async function showStalyRozvrhInChat(event) {
            if (event) event.preventDefault();
            closeRozvrhModal();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '80%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            const htmlContent = `
                <h3 style="color: #667eea; font-size: 18px; margin: 0 0 15px 0;">üìã St√°l√Ω rozvrh</h3>
                <p style="margin: 8px 0;"><strong>Pondƒõl√≠:</strong><br>
                1. Matematika (8:00-8:45)<br>
                2. ƒåesk√Ω jazyk (8:55-9:40)<br>
                3. Angliƒçtina (9:50-10:35)<br>
                4. Fyzika (10:50-11:35)<br>
                5. Dƒõjepis (11:45-12:30)<br>
                6. Tƒõlesn√° v√Ωchova (12:40-13:25)</p>
                
                <p style="margin: 8px 0;"><strong>√öter√Ω:</strong><br>
                1. Chemie (8:00-8:45)<br>
                2. Matematika (8:55-9:40)<br>
                3. ƒåesk√Ω jazyk (9:50-10:35)<br>
                4. Angliƒçtina (10:50-11:35)<br>
                5. Informatika (11:45-12:30)</p>
                
                <p style="margin-top: 15px; font-style: italic;">üí° Kompletn√≠ rozvrh najde≈° na webu ≈°koly</p>
            `;
            
            // Pou≈æijeme typing efekt
            await typeHtmlMessage(contentDiv, htmlContent, 1);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ t√Ωdenn√≠ho rozvrhu v chatu
        async function showTydenniRozvrhInChat(event) {
            if (event) event.preventDefault();
            closeRozvrhModal();
            
            addMessage('üìÜ Rozvrh na cel√Ω t√Ωden - tato funkce bude doplnƒõna s detailn√≠m t√Ωdenn√≠m rozvrhem vƒçetnƒõ v≈°ech dn≈Ø a hodin.', false);
        }
        
        // Funkce pro zobrazen√≠ rozvrhu vybran√© t≈ô√≠dy
        async function showRozvrhTridy(trida) {
            // Zav≈ôeme modal
            closeRozvrhModal();
            
            // Zobraz√≠me loading zpr√°vu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'rozvrhTridyLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            
            // P≈ôelo≈æ√≠me n√°zev t≈ô√≠dy pro u≈æivatele
            const tridaNazvy = {
                'prima': 'Prima',
                'sekunda': 'Sekunda',
                'tercie': 'Tercie',
                'kvarta': 'Kvarta',
                'kvinta': 'Kvinta',
                'sexta': 'Sexta',
                'septima': 'Septima',
                'oktava': 'Okt√°va'
            };
            
            loadingContent.textContent = `‚è≥ Naƒç√≠t√°m rozvrh pro t≈ô√≠du ${tridaNazvy[trida]}...`;
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Zat√≠m zobraz√≠me placeholder s uk√°zkov√Ωm rozvrhem
            setTimeout(async () => {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('rozvrhTridyLoading');
                if (loading) loading.remove();
                
                // Vytvo≈ô√≠me zpr√°vu s rozvrhem
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.style.maxWidth = '80%';
                
                messageDiv.appendChild(contentDiv);
                chatContainer.appendChild(messageDiv);
                
                const htmlContent = `
                    <h3 style="color: #667eea; font-size: 13px; margin: 0 0 10px 0;">üìÖ Rozvrh t≈ô√≠dy ${tridaNazvy[trida]}</h3>
                    
                    <p style="margin: 5px 0; font-size: 11px;"><strong>Pondƒõl√≠:</strong><br>
                    1. Matematika (8:00-8:45)<br>
                    2. ƒåesk√Ω jazyk (8:55-9:40)<br>
                    3. Angliƒçtina (9:50-10:35)<br>
                    4. Fyzika (10:50-11:35)<br>
                    5. Dƒõjepis (11:45-12:30)<br>
                    6. Tƒõlesn√° v√Ωchova (12:40-13:25)</p>
                    
                    <p style="margin: 5px 0; font-size: 11px;"><strong>√öter√Ω:</strong><br>
                    1. Chemie (8:00-8:45)<br>
                    2. Matematika (8:55-9:40)<br>
                    3. ƒåesk√Ω jazyk (9:50-10:35)<br>
                    4. Angliƒçtina (10:50-11:35)<br>
                    5. Informatika (11:45-12:30)</p>
                    
                    <p style="margin-top: 10px; font-style: italic; font-size: 10px;">üí° Kompletn√≠ t√Ωdenn√≠ rozvrh najde≈° na webu ≈°koly nebo v aplikaci Bakal√°≈ôi</p>
                `;
                
                // Pou≈æijeme typing efekt
                await typeHtmlMessage(contentDiv, htmlContent, 1);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 500);
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy PA z Bakal√°≈ô≈Ø
        async function showRozvrhPA() {
            await showRozvrhTridyReal('PA', '/rozvrh/pa', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/2B');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy PB z Bakal√°≈ô≈Ø
        async function showRozvrhPB() {
            await showRozvrhTridyReal('PB', '/rozvrh/pb', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/2C');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy SA z Bakal√°≈ô≈Ø
        async function showRozvrhSA() {
            await showRozvrhTridyReal('SA', '/rozvrh/sa', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/28');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy SB z Bakal√°≈ô≈Ø
        async function showRozvrhSB() {
            await showRozvrhTridyReal('SB', '/rozvrh/sb', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/29');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy TA z Bakal√°≈ô≈Ø
        async function showRozvrhTA() {
            await showRozvrhTridyReal('TA', '/rozvrh/ta', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/25');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy TB z Bakal√°≈ô≈Ø
        async function showRozvrhTB() {
            await showRozvrhTridyReal('TB', '/rozvrh/tb', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/26');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy KVA z Bakal√°≈ô≈Ø
        async function showRozvrhKVA() {
            await showRozvrhTridyReal('KVA', '/rozvrh/kva', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/22');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy KVB z Bakal√°≈ô≈Ø
        async function showRozvrhKVB() {
            await showRozvrhTridyReal('KVB', '/rozvrh/kvb', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/23');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy 1W z Bakal√°≈ô≈Ø
        async function showRozvrh1W() {
            console.log('üîç showRozvrh1W() zavol√°na');
            await showRozvrhTridyReal('1W', '/rozvrh/1w', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/1W');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy SXA z Bakal√°≈ô≈Ø
        async function showRozvrhSXA() {
            console.log('üîç showRozvrhSXA() zavol√°na');
            await showRozvrhTridyReal('SXA', '/rozvrh/1w', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/1W');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy 1.A z Bakal√°≈ô≈Ø
        async function showRozvrh1A() {
            console.log('üîç showRozvrh1A() zavol√°na');
            await showRozvrhTridyReal('1.A', '/rozvrh/1a', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/1A');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy KVIA z Bakal√°≈ô≈Ø
        async function showRozvrhKVIA() {
            console.log('üîç showRozvrhKVIA() zavol√°na');
            await showRozvrhTridyReal('KVIA', '/rozvrh/kvia', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/KVIA');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy KVIB z Bakal√°≈ô≈Ø
        async function showRozvrhKVIB() {
            console.log('üîç showRozvrhKVIB() zavol√°na');
            await showRozvrhTridyReal('KVIB', '/rozvrh/kvib', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/KVIB');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy 2.A z Bakal√°≈ô≈Ø
        async function showRozvrh2A() {
            console.log('üîç showRozvrh2A() zavol√°na');
            await showRozvrhTridyReal('2.A', '/rozvrh/2a', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/2A');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy SXB z Bakal√°≈ô≈Ø
        async function showRozvrhSXB() {
            console.log('üîç showRozvrhSXB() zavol√°na');
            await showRozvrhTridyReal('SXB', '/rozvrh/sxb', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/SXB');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy 3.A z Bakal√°≈ô≈Ø
        async function showRozvrh3A() {
            console.log('üîç showRozvrh3A() zavol√°na');
            await showRozvrhTridyReal('3.A', '/rozvrh/3a', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/3A');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy SPTA z Bakal√°≈ô≈Ø
        async function showRozvrhSPTA() {
            console.log('üîç showRozvrhSPTA() zavol√°na');
            await showRozvrhTridyReal('SPTA', '/rozvrh/spta', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/SPTA');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy SPTB z Bakal√°≈ô≈Ø
        async function showRozvrhSPTB() {
            console.log('üîç showRozvrhSPTB() zavol√°na');
            await showRozvrhTridyReal('SPTB', '/rozvrh/sptb', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/SPTB');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy 4.A z Bakal√°≈ô≈Ø
        async function showRozvrh4A() {
            console.log('üîç showRozvrh4A() zavol√°na');
            await showRozvrhTridyReal('4.A', '/rozvrh/4a', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/4A');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy OKTA z Bakal√°≈ô≈Ø
        async function showRozvrhOKTA() {
            console.log('üîç showRozvrhOKTA() zavol√°na');
            await showRozvrhTridyReal('OKTA', '/rozvrh/okta', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/OKTA');
        }
        
        // Funkce pro naƒçten√≠ a zobrazen√≠ rozvrhu t≈ô√≠dy OKTB z Bakal√°≈ô≈Ø
        async function showRozvrhOKTB() {
            console.log('üîç showRozvrhOKTB() zavol√°na');
            await showRozvrhTridyReal('OKTB', '/rozvrh/oktb', 'https://mgo.bakalari.cz/bakaweb/Timetable/Public/Actual/Class/OKTB');
        }
        
        // Obecn√° funkce pro naƒçten√≠ rozvrhu z backendu (funkƒçn√≠ verze)
        async function showRozvrhTridyReal(nazevTridy, endpoint, bakalariUrl) {
            console.log('üîç showRozvrhTridyReal() zavol√°na pro t≈ô√≠du:', nazevTridy, 'endpoint:', endpoint);
            
            // Zav≈ôeme modal
            closeRozvrhModal();
            
            // Nejd≈ô√≠v zobraz√≠me zpr√°vu u≈æivatele
            addMessage(`Rozvrh ${nazevTridy}`, true);
            
            // Zobraz√≠me loading zpr√°vu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'rozvrhLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            loadingContent.textContent = `‚è≥ Naƒç√≠t√°m rozvrh pro t≈ô√≠du ${nazevTridy} z Bakal√°≈ô≈Ø...`;
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                // Zavol√°me backend endpoint pro scraping rozvrhu
                console.log('üîç Vol√°m API:', `${CONFIG.API_BASE_URL}${endpoint}`);
                const response = await fetch(`${CONFIG.API_BASE_URL}${endpoint}`);
                console.log('üîç Response status:', response.status);
                const result = await response.json();
                console.log('üîç V√Ωsledek z API:', result);
                
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('rozvrhLoading');
                if (loading) loading.remove();
                
                if (result.success && result.data) {
                    // Funkce pro zji≈°tƒõn√≠, zda je po posledn√≠ hodinƒõ
                    const isAfterLastLesson = (hodiny) => {
                        if (!hodiny || hodiny.length === 0) return false;
                        
                        // Najdi posledn√≠ hodinu
                        const posledniHodina = hodiny[hodiny.length - 1];
                        if (!posledniHodina.cas) return false;
                        
                        // Extrahuj ƒças konce (nap≈ô. "8:15-9:00" -> "9:00")
                        const casMatch = posledniHodina.cas.match(/(\d+):(\d+)$/);
                        if (!casMatch) return false;
                        
                        const konecHodiny = parseInt(casMatch[1]) * 60 + parseInt(casMatch[2]);
                        
                        // Aktu√°ln√≠ ƒças
                        const now = new Date();
                        const aktualniCas = now.getHours() * 60 + now.getMinutes();
                        
                        return aktualniCas > konecHodiny;
                    };
                    
                    // Zjist√≠me, jestli je po posledn√≠ hodinƒõ
                    const jePoPoslednHodine = isAfterLastLesson(result.data.hodiny);
                    
                    // Vytvo≈ô√≠me zpr√°vu s rozvrhem
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.style.maxWidth = '80%';
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    let denZobrazeni = result.data.den;
                    if (jePoPoslednHodine) {
                        // Mapov√°n√≠ dn≈Ø pro zji≈°tƒõn√≠ n√°sleduj√≠c√≠ho dne
                        const dnyTydne = ['Nedƒõle', 'Pondƒõl√≠', '√öter√Ω', 'St≈ôeda', 'ƒåtvrtek', 'P√°tek', 'Sobota'];
                        const now = new Date();
                        let denIndex = now.getDay();
                        
                        // P≈ôeskok na dal≈°√≠ pracovn√≠ den
                        denIndex++;
                        if (denIndex === 6) denIndex = 1; // Sobota -> Pondƒõl√≠
                        if (denIndex === 0) denIndex = 1; // Nedƒõle -> Pondƒõl√≠
                        
                        denZobrazeni = `${dnyTydne[denIndex]} (z√≠t≈ôej≈°√≠ rozvrh)`;
                    }
                    
                    // Zkontroluj, jestli jsou k dispozici hodiny
                    const maHodiny = result.data.hodiny && result.data.hodiny.length > 0;
                    
                    let htmlContent = `<h3 style="color: #667eea; font-size: 13px; margin: 0 0 10px 0;">üìÖ Rozvrh t≈ô√≠dy ${nazevTridy} - ${denZobrazeni}</h3>`;
                    
                    if (jePoPoslednHodine) {
                        // Kdy≈æ skonƒçil den, zobraz jen upozornƒõn√≠ s odkazem
                        htmlContent += `<p style="margin: 10px 0; font-size: 11px; line-height: 1.6; color: #555;">‚ö†Ô∏è <strong>Dne≈°n√≠ rozvrh ji≈æ nen√≠ aktu√°ln√≠.</strong> Posledn√≠ hodina ji≈æ skonƒçila. Moment√°lnƒõ neum√≠m naƒç√≠st data z webov√© str√°nky pro dal≈°√≠ den, proto≈æe nejsou na webu k dispozici. Jakmile budou data k dispozici, zobraz√≠m ti rozvrh.<br><br>üìÖ Kompletn√≠ rozvrh najde≈° na <a href="${bakalariUrl}" target="_blank" rel="noopener noreferrer" style="color: #667eea; text-decoration: underline;">rozvrhu t≈ô√≠dy ${nazevTridy}</a></p>`;
                    } else if (maHodiny) {
                        // Zobraz rozvrh pouze kdy≈æ jsou dostupn√© hodiny
                        result.data.hodiny.forEach(hodina => {
                            htmlContent += `<p style="margin: 5px 0; font-size: 11px;"><strong>${hodina.cislo}. hodina (${hodina.cas}):</strong> ${hodina.predmet}`;
                            if (hodina.ucitel) {
                                htmlContent += ` - ${hodina.ucitel}`;
                            }
                            if (hodina.mistnost) {
                                htmlContent += ` (${hodina.mistnost})`;
                            }
                            htmlContent += '</p>';
                        });
                        
                        htmlContent += `<p style="margin-top: 10px; font-style: italic; font-size: 10px;">üí° Pokud chce≈° zobrazit ostatn√≠ dny, klikni na n√≠≈æe uveden√Ω odkaz<br>üìå Zdroj: <a href="${bakalariUrl}" target="_blank" style="color: #667eea; text-decoration: none;">Bakal√°≈ôi MGO</a></p>`;
                    } else {
                        // Kdy≈æ nejsou ≈æ√°dn√© hodiny, nezobrazuj nic (jen nadpis z≈Østane)
                        htmlContent += `<p style="margin: 10px 0; font-size: 11px; line-height: 1.6; color: #555;">üì≠ <strong>Dnes nejsou k dispozici ≈æ√°dn√© hodiny.</strong><br><br>ÔøΩ Kompletn√≠ rozvrh najde≈° na <a href="${bakalariUrl}" target="_blank" rel="noopener noreferrer" style="color: #667eea; text-decoration: underline;">rozvrhu t≈ô√≠dy ${nazevTridy}</a></p>`;
                    }
                    
                    // Pou≈æijeme typing efekt pro HTML obsah
                    await typeHtmlMessage(contentDiv, htmlContent, 1);
                } else {
                    addMessage(`‚ùå Nepoda≈ôilo se naƒç√≠st rozvrh t≈ô√≠dy ${nazevTridy}. Zkus to pros√≠m pozdƒõji.`, false);
                }
                
            } catch (error) {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('rozvrhLoading');
                if (loading) loading.remove();
                
                console.error(`Chyba p≈ôi naƒç√≠t√°n√≠ rozvrhu ${nazevTridy}:`, error);
                addMessage('‚ùå Do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ rozvrhu. Zkus to pros√≠m znovu.', false);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Obecn√° funkce pro naƒçten√≠ rozvrhu - placeholder verze (pro t≈ô√≠dy bez URL)
        async function showRozvrhTridy(nazevTridy, endpoint, bakalariUrl) {
            // Zav≈ôeme modal
            closeRozvrhModal();
            
            // Zobraz√≠me zpr√°vu
            addMessage(`üìÖ Rozvrh t≈ô√≠dy ${nazevTridy}\n\n‚ö†Ô∏è Tato t≈ô√≠da je≈°tƒõ nen√≠ p≈ôipravena. Dopl≈à pros√≠m URL na str√°nku Bakal√°≈ô≈Ø v k√≥du.\n\nüí° Endpoint: ${endpoint}\nüí° URL bude: ${bakalariUrl}`, false);
        }
        
        // Generuj unik√°tn√≠ user ID nebo pou≈æij existuj√≠c√≠ z localStorage
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }

        // Funkce pro typing efekt (p√≠smenka po p√≠smenku)
        async function typeMessage(element, text, speed = 50) {
            if (!typingEnabled) {
                // Okam≈æit√© zobrazen√≠ bez typing efektu
                element.textContent = text;
                if (chatContainer.scrollHeight > chatContainer.clientHeight) {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
                return;
            }
            
            // Zv√Ω≈°√≠me poƒç√≠tadlo aktivn√≠ch typing efekt≈Ø
            activeTypingCount++;
            
            // Nastav√≠me glob√°ln√≠ promƒõnn√© pro mo≈ænost p≈ôeskoƒçen√≠
            currentTypingElement = element;
            currentFullText = text;
            skipTyping = false;
            
            // Zobraz√≠me tlaƒç√≠tko stopky
            showSkipButton();
            
            for (let i = 0; i < text.length; i++) {
                // Pokud bylo po≈æadov√°no p≈ôeskoƒçen√≠, ukonƒç√≠me smyƒçku
                if (skipTyping) {
                    element.textContent = text; // Dokonƒç√≠me text
                    break;
                }
                
                element.textContent += text.charAt(i);
                
                // Scrollujeme dol≈Ø ka≈æd√Ωch 10 znak≈Ø pouze pokud je chat pln√Ω
                if (i % 10 === 0 && chatContainer.scrollHeight > chatContainer.clientHeight) {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
                
                await new Promise(resolve => setTimeout(resolve, speed));
            }
            
            // Po dokonƒçen√≠ vynulujeme glob√°ln√≠ promƒõnn√©
            currentTypingElement = null;
            currentFullText = '';
            skipTyping = false;
            
            // Sn√≠≈æ√≠me poƒç√≠tadlo aktivn√≠ch typing efekt≈Ø
            activeTypingCount--;
            
            // Skryjeme tlaƒç√≠tko stopky (jen pokud u≈æ nebƒõ≈æ√≠ ≈æ√°dn√Ω typing)
            hideSkipButton();
            
            // Fin√°ln√≠ scroll dol≈Ø pouze pokud je chat pln√Ω
            if (chatContainer.scrollHeight > chatContainer.clientHeight) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        // Funkce pro typing efekt s HTML obsahem - JEDNODUCH√Å VERZE s p≈ôirozen√Ωm rytmem
        async function typeHtmlMessage(element, htmlContent, speed = 5) {
            // Zv√Ω≈°√≠me poƒç√≠tadlo aktivn√≠ch typing efekt≈Ø
            activeTypingCount++;
            
            // Nastav√≠me glob√°ln√≠ promƒõnn√©
            currentTypingElement = element;
            currentFullText = htmlContent;
            skipTyping = false;
            
            // Zobraz√≠me tlaƒç√≠tko stopky
            showSkipButton();
            
            // Prostƒõ zobraz√≠me HTML obsah znak po znaku jako plain text s interpretac√≠ HTML
            let displayedText = '';
            
            for (let i = 0; i < htmlContent.length; i++) {
                if (skipTyping) {
                    element.innerHTML = htmlContent;
                    break;
                }
                
                displayedText += htmlContent.charAt(i);
                element.innerHTML = displayedText;
                
                // Scrollujeme m√©nƒõ ƒçasto - ka≈æd√Ωch 200 znak≈Ø nebo kdy≈æ je to pot≈ôeba
                if (i % 200 === 0) {
                    // Plynul√Ω scroll
                    chatContainer.scrollTo({
                        top: chatContainer.scrollHeight,
                        behavior: 'smooth'
                    });
                }
                
                // Plynul√Ω typing s konstantn√≠ rychlost√≠
                const char = htmlContent.charAt(i);
                let delay = speed;
                
                // Rychlej≈°√≠ pro HTML tagy (neviditeln√©)
                if (char === '<') {
                    // P≈ôeskoƒç√≠me cel√Ω tag
                    let tagEnd = htmlContent.indexOf('>', i);
                    if (tagEnd > i) {
                        displayedText = htmlContent.substring(0, tagEnd + 1);
                        element.innerHTML = displayedText;
                        i = tagEnd;
                        continue;
                    }
                }
                
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            
            currentTypingElement = null;
            currentFullText = '';
            skipTyping = false;
            
            // Sn√≠≈æ√≠me poƒç√≠tadlo aktivn√≠ch typing efekt≈Ø
            activeTypingCount--;
            
            // Skryjeme tlaƒç√≠tko stopky (jen pokud u≈æ nebƒõ≈æ√≠ ≈æ√°dn√Ω typing)
            hideSkipButton();
            
            // Fin√°ln√≠ plynul√Ω scroll
            chatContainer.scrollTo({
                top: chatContainer.scrollHeight,
                behavior: 'smooth'
            });
        }

        // Zobrazen√≠ uv√≠tac√≠ zpr√°vy s typing efektem
        async function showWelcomeMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '70%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);

            // Typing efekt pro uv√≠tac√≠ zpr√°vu
            await typeMessage(contentDiv, 'Ahoj! üëã Jsem MATIƒå√ÅK, tv≈Øj ≈°koln√≠ AI pomocn√≠k. Jak ti m≈Ø≈æu dnes pomoci?\n\nPro rychl√Ω p≈ô√≠stup pou≈æij tlaƒç√≠tka naho≈ôe! ‚¨ÜÔ∏è\n\nNebo napi≈° kl√≠ƒçov√° slova do chatu (nap≈ô. "rozvrh", "j√≠delna", "uƒçitel√©"). üí¨', 50);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Modal s ozn√°men√≠m o p≈ôij√≠mac√≠m ≈ô√≠zen√≠
        // Naƒçten√≠ a zobrazen√≠ novinek z JSON
        async function loadNovinky() {
            try {
                const response = await fetch('data/novinky/novinky.json');
                const data = await response.json();
                
                // Filtrovat pouze aktivn√≠ novinky a se≈ôadit od nejnovƒõj≈°√≠ho
                const aktivniNovinky = data.novinky
                    .filter(n => n.aktivni)
                    .sort((a, b) => new Date(b.datum) - new Date(a.datum))
                    .slice(0, 5); // Maximum 5 novinek
                
                return aktivniNovinky;
            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ novinek:', error);
                return [];
            }
        }
        
        // Zobrazen√≠ novinek v modalu
        async function showAnnouncementModal() {
            const modal = document.getElementById('novinkaModal');
            const modalBody = document.getElementById('novinkyModalBody');
            
            modal.style.display = 'block';
            
            // Zastavit blik√°n√≠ badge po otev≈ôen√≠
            const badge = document.getElementById('novinkaBadge');
            if (badge) {
                badge.style.animation = 'none';
            }
            
            // Naƒç√≠st novinky
            const novinky = await loadNovinky();
            
            if (novinky.length === 0) {
                modalBody.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <p style="font-size: 48px; margin: 0;">üì≠</p>
                        <p style="font-size: 16px; margin-top: 10px;">Moment√°lnƒõ nejsou ≈æ√°dn√© novinky</p>
                    </div>
                `;
                return;
            }
            
            // Vygenerovat HTML pro novinky
            let html = '';
            
            novinky.forEach((novinka, index) => {
                const kategorieBadge = getCategoryBadge(novinka.kategorie);
                const formatovaneDatum = formatDatum(novinka.datum);
                
                html += `
                    <div style="background: white; border: 2px solid #f0f0f0; border-radius: 12px; padding: 20px; margin-bottom: 16px; transition: all 0.3s; cursor: pointer;" 
                         onmouseover="this.style.borderColor='#667eea'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.2)'" 
                         onmouseout="this.style.borderColor='#f0f0f0'; this.style.boxShadow='none'"
                         onclick="toggleNovinkaDetail(${novinka.id})">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 28px;">${novinka.ikona}</span>
                                <div>
                                    <h3 style="margin: 0; font-size: 17px; color: #333;">${novinka.nadpis}</h3>
                                    <p style="margin: 4px 0 0 0; font-size: 12px; color: #999;">üìÖ ${formatovaneDatum}</p>
                                </div>
                            </div>
                            ${kategorieBadge}
                        </div>
                        <div id="novinka-detail-${novinka.id}" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0;">
                            ${renderNovinkaContent(novinka)}
                        </div>
                        <div style="text-align: center; margin-top: 8px; color: #667eea; font-size: 12px; font-weight: 600;">
                            <span id="novinka-toggle-${novinka.id}">‚ñº Zobrazit detail</span>
                        </div>
                    </div>
                `;
            });
            
            modalBody.innerHTML = html;
        }
        
        // Rozbalen√≠/sbalen√≠ detailu novinky
        function toggleNovinkaDetail(id) {
            const detail = document.getElementById(`novinka-detail-${id}`);
            const toggle = document.getElementById(`novinka-toggle-${id}`);
            
            if (detail.style.display === 'none') {
                detail.style.display = 'block';
                toggle.textContent = '‚ñ≤ Skr√Ωt detail';
            } else {
                detail.style.display = 'none';
                toggle.textContent = '‚ñº Zobrazit detail';
            }
        }
        
        // Z√≠skat badge podle kategorie
        function getCategoryBadge(kategorie) {
            const badges = {
                'D≈Øle≈æit√©': '<span style="background: #ff6b6b; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">‚ö†Ô∏è D≈Øle≈æit√©</span>',
                'Akce': '<span style="background: #4ecdc4; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">üéâ Akce</span>',
                'Technologie': '<span style="background: #667eea; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">üíª Tech</span>',
                'Info': '<span style="background: #95a5a6; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">‚ÑπÔ∏è Info</span>'
            };
            return badges[kategorie] || badges['Info'];
        }
        
        // Form√°tovat datum
        function formatDatum(datum) {
            const d = new Date(datum);
            const den = d.getDate().toString().padStart(2, '0');
            const mesic = (d.getMonth() + 1).toString().padStart(2, '0');
            const rok = d.getFullYear();
            return `${den}.${mesic}.${rok}`;
        }
        
        // Vykreslit obsah novinky podle typu
        function renderNovinkaContent(novinka) {
            let html = '';
            const obsah = novinka.obsah;
            
            // Speci√°ln√≠ form√°tov√°n√≠ pro p≈ôij√≠mac√≠ ≈ô√≠zen√≠
            if (obsah.prihlaskyTermin) {
                html += `
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: 600; font-size: 14px; color: #667eea; margin-bottom: 6px;">üóìÔ∏è Term√≠ny pod√°n√≠ p≈ôihl√°≈°ek</div>
                        <div style="background: #f8f9ff; padding: 10px; border-radius: 6px; border-left: 3px solid #667eea;">
                            <p style="margin: 0; font-size: 13px;">üìù ${obsah.prihlaskyTermin}</p>
                        </div>
                    </div>
                `;
            }
            
            if (obsah.zkouskyTerminy) {
                html += `
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: 600; font-size: 14px; color: #667eea; margin-bottom: 6px;">üìù Term√≠ny p≈ôij√≠mac√≠ch zkou≈°ek</div>
                        <div style="background: #f8f9ff; padding: 10px; border-radius: 6px; border-left: 3px solid #667eea;">
                            ${obsah.zkouskyTerminy.map(t => `<p style="margin: 0 0 4px 0; font-size: 13px;">üìå ${t}</p>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            if (obsah.dokumenty) {
                html += `
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: 600; font-size: 14px; color: #667eea; margin-bottom: 6px;">üìÑ Pot≈ôebn√© dokumenty</div>
                        <div style="background: #f8f9ff; padding: 10px; border-radius: 6px; border-left: 3px solid #667eea;">
                            <ul style="margin: 0; padding-left: 18px; font-size: 13px;">
                                ${obsah.dokumenty.map(d => `<li style="margin-bottom: 2px;">${d}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            // Obecn√Ω text
            if (obsah.text) {
                html += `<p style="font-size: 14px; line-height: 1.6; color: #555; margin: 0 0 12px 0;">${obsah.text}</p>`;
            }
            
            // Term√≠n akce
            if (obsah.termin) {
                html += `
                    <div style="background: #fff9e6; padding: 10px; border-radius: 6px; border-left: 3px solid #ffd93d; margin-bottom: 12px;">
                        <p style="margin: 0; font-size: 13px;"><strong>üìÖ Term√≠n:</strong> ${obsah.termin}</p>
                    </div>
                `;
            }
            
            // Funkce/seznam
            if (obsah.funkce) {
                html += `
                    <div style="margin-bottom: 12px;">
                        <ul style="margin: 0; padding-left: 18px; font-size: 13px; color: #555;">
                            ${obsah.funkce.map(f => `<li style="margin-bottom: 4px;">${f}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Dodatek
            if (obsah.dodatek) {
                html += `
                    <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 12px; border-radius: 6px; text-align: center; margin-top: 12px;">
                        <p style="margin: 0; font-size: 12px; color: #555;">üí° ${obsah.dodatek}</p>
                    </div>
                `;
            }
            
            return html;
        }
        
        function closeNovinkaModal() {
            document.getElementById('novinkaModal').style.display = 'none';
        }

        // Zabr√°n√≠me opakovan√©mu spu≈°tƒõn√≠
        let welcomeShown = false;

        function addMessage(text, isUser) {

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (isUser) {
                // U≈æivatelsk√© zpr√°vy bez typing efektu
                contentDiv.textContent = text;
            } else {
                // Bot zpr√°vy s typing efektem
                contentDiv.textContent = '';
            }
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Spust√≠me typing efekt pro bot zpr√°vy
            if (!isUser) {
                typeMessage(contentDiv, text, 30);
            }
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator active';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            
            typingDiv.appendChild(indicator);
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Funkce pro detekci dotazu na j√≠delnu (zobraz√≠ modal j√≠delny)
        function detectCanteenRequest(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            const canteenKeywords = [
                'jidelna', 'jidelny', 'jidelne', 'jidelnou',
                'obed', 'obeda', 'obedu', 'obedem', 'obedy',
                'menu', 'jidelnicek', 'jidelni listek',
                'jidlo', 'jidla', 'jidel',
                'strava', 'stravy', 'strave',
                'kantyna', 'kantyne',
                'co je na obed', 'co bude na obed', 'co maji na obed',
                'co se vari', 'co se dnes vari', 'co se zitra vari',
                'co si dam k jidlu', 'kde se najedim'
            ];
            
            for (const keyword of canteenKeywords) {
                if (lowerMessage.includes(keyword)) {
                    return true;
                }
            }
            
            return false;
        }

        // Funkce pro detekci konkr√©tn√≠ho dne v dotazu na j√≠dlo
        function detectCanteenDayRequest(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            // Kontrola, zda zpr√°va obsahuje nƒõco o j√≠dle
            const foodMentioned = ['obed', 'jidlo', 'menu', 'jidelna', 'strava', 'vari'].some(word => 
                lowerMessage.includes(word)
            );
            
            if (!foodMentioned) return null;
            
            // Detekce konkr√©tn√≠ch dn≈Ø
            const dayPatterns = {
                'dnes': ['dnes', 'dnesni', 'dneska', 'dne≈°n√≠'],
                'zitra': ['zitra', 'zitrejsi', 'zitrek', 'z√≠t≈ôej≈°√≠', 'z√≠tra'],
                'pozitri': ['pozitri', 'popozitri', 'pozitrejsi', 'poz√≠t≈ô√≠', 'popoz√≠t≈ô√≠'],
                'pondeli': ['pondeli', 'v pondeli', 'na pondeli', 'pondƒõl√≠'],
                'utery': ['utery', 'v utery', 'na utery', '√∫ter√Ω'],
                'streda': ['streda', 've stredu', 'na stredu', 'st≈ôeda', 've st≈ôedu'],
                'ctvrtek': ['ctvrtek', 've ctvrtek', 'na ctvrtek', 'ƒçtvrtek'],
                'patek': ['patek', 'v patek', 'na patek', 'p√°tek']
            };
            
            for (const [day, patterns] of Object.entries(dayPatterns)) {
                for (const pattern of patterns) {
                    if (lowerMessage.includes(pattern)) {
                        return day;
                    }
                }
            }
            
            return null;
        }

        // Funkce pro zobrazen√≠ menu konkr√©tn√≠ho dne v chatu
        async function showMenuForDay(day) {
            const dayNames = {
                'dnes': 'dnes',
                'zitra': 'z√≠tra',
                'pozitri': 'poz√≠t≈ô√≠',
                'pondeli': 'v pondƒõl√≠',
                'utery': 'v √∫ter√Ω',
                'streda': 've st≈ôedu',
                'ctvrtek': 've ƒçtvrtek',
                'patek': 'v p√°tek'
            };
            
            const dayName = dayNames[day] || day;
            
            try {
                // Naƒçteme t√Ωdenn√≠ menu
                const response = await fetch(`${CONFIG.API_BASE_URL}/jidelna/tydenni-menu`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Najdeme spr√°vn√Ω den
                    const today = new Date();
                    let targetDate = new Date(today);
                    
                    if (day === 'zitra') {
                        targetDate.setDate(today.getDate() + 1);
                    } else if (day === 'pozitri') {
                        targetDate.setDate(today.getDate() + 2);
                    } else if (day !== 'dnes') {
                        // Pro konkr√©tn√≠ den v t√Ωdnu
                        const dayMap = {
                            'pondeli': 1, 'utery': 2, 'streda': 3, 'ctvrtek': 4, 'patek': 5
                        };
                        const targetDay = dayMap[day];
                        const currentDay = today.getDay();
                        let daysToAdd = targetDay - currentDay;
                        if (daysToAdd <= 0) daysToAdd += 7;
                        targetDate.setDate(today.getDate() + daysToAdd);
                    }
                    
                    // Form√°t data pro hled√°n√≠ (nap≈ô. "12.12.2025")
                    const dateStr = `${targetDate.getDate()}.${targetDate.getMonth() + 1}.${targetDate.getFullYear()}`;
                    
                    // Data mohou b√Ωt buƒè v "dny" poli nebo p≈ô√≠mo jako pole
                    const menuArray = result.data.dny || result.data;
                    
                    // Najdeme menu pro tento den - API vrac√≠ pole "datum" ve form√°tu "12.12.2025"
                    const menuItem = menuArray.find(item => {
                        if (item.datum) {
                            return item.datum === dateStr;
                        }
                        return false;
                    });
                    
                    if (menuItem && menuItem.menu && menuItem.menu.length > 0) {
                        let menuText = `üçΩÔ∏è Menu ${dayName} (${dateStr}):\n\n`;
                        
                        // API vrac√≠ menu jako pole objekt≈Ø s "typ" a "nazev"
                        menuItem.menu.forEach(item => {
                            if (item.typ && item.nazev && item.nazev !== "Informace nen√≠ dostupn√°") {
                                const icon = item.typ.includes('Obƒõd') ? 'üçñ' : 'ü•ó';
                                menuText += `${icon} ${item.typ}: ${item.nazev}\n\n`;
                            }
                        });
                        
                        await addMessage(menuText, false);
                    } else {
                        await addMessage(`üòï Omlouv√°me se, ale menu ${dayName} nen√≠ k dispozici.`, false);
                    }
                } else {
                    await addMessage('üòï Nepoda≈ôilo se naƒç√≠st j√≠deln√≠ l√≠stek.', false);
                }
            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ menu:', error);
                await addMessage('üòï Nastala chyba p≈ôi naƒç√≠t√°n√≠ menu.', false);
            }
        }

        // Funkce pro detekci dotazu na veden√≠ ≈°koly (zobraz√≠ modal kontakt≈Ø)
        function detectLeadershipRequest(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            const leadershipKeywords = [
                'vedeni', 'vedeniho', 'vedenim',
                'reditel', 'reditele', 'rediteli', 'reditelem', 'reditelka', 'reditelky', 'reditelce',
                'zastupce', 'zastupcu', 'zastupcem', 'zastupkyne', 'zastupkyne',
                'management', 'managementu',
                'statutar', 'statutarni organ'
            ];
            
            for (const keyword of leadershipKeywords) {
                if (lowerMessage.includes(keyword)) {
                    return true;
                }
            }
            
            return false;
        }

        // Funkce pro detekci dotazu na uƒçitele/pedagogy (zobraz√≠ modal s uƒçiteli)
        function detectTeacherRequest(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            const teacherKeywords = [
                'ucitel', 'ucitele', 'ucitelka', 'ucitelu', 'ucitelem',
                'pedagog', 'pedagoga', 'pedagogy', 'pedagogu',
                'vyucujici',
                'pan ucitel', 'pani ucitelka', 'pan profesor', 'pani profesorka'
            ];
            
            for (const keyword of teacherKeywords) {
                if (lowerMessage.includes(keyword)) {
                    return true;
                }
            }
            
            return false;
        }

        // Funkce pro detekci dotazu na konkr√©tn√≠ p≈ôedmƒõt (zobraz√≠ modal s p≈ôedmƒõty)
        function detectSubjectRequest(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            const subjectKeywords = {
                // Matematika
                'matematika': 'M', 'matematiky': 'M', 'matematice': 'M', 'matika': 'M', 'matiky': 'M', 'matek': 'M', 'matka': 'M', 'mat': 'M',
                // ƒåe≈°tina
                'cestina': 'ƒåj', 'cestiny': 'ƒåj', 'cestin': 'ƒåj', 'cesky jazyk': 'ƒåj', 'cesky': 'ƒåj', 'cj': 'ƒåj', 'cestinare': 'ƒåj',
                // Angliƒçtina
                'anglictina': 'Aj', 'angliƒçtina': 'Aj', 'anglictiny': 'Aj', 'angliƒçtiny': 'Aj', 'anglictin': 'Aj', 'angliƒçtinƒõ': 'Aj', 'anglicky': 'Aj', 'aj': 'Aj', 'anglicky jazyk': 'Aj', 'anglist': 'Aj', 'anglina': 'Aj', 'angl√≠na': 'Aj',
                // Nƒõmƒçina
                'nemcina': 'Nj', 'nƒõmƒçina': 'Nj', 'nemciny': 'Nj', 'nƒõmƒçiny': 'Nj', 'nemecky': 'Nj', 'nƒõmecky': 'Nj', 'nj': 'Nj', 'nemecky jazyk': 'Nj', 'nemina': 'Nj', 'nƒõmina': 'Nj',
                // ≈†panƒõl≈°tina
                'spanelstina': '≈†j', '≈°panƒõl≈°tina': '≈†j', 'spanelstiny': '≈†j', '≈°panƒõl≈°tiny': '≈†j', 'spanelsky': '≈†j', '≈°panƒõlsky': '≈†j', 'sj': '≈†j', 'spanelsky jazyk': '≈†j', 'spanina': '≈†j', '≈°panina': '≈†j',
                // Francouz≈°tina
                'francouzstina': 'Fj', 'francouz≈°tina': 'Fj', 'francouzstiny': 'Fj', 'francouz≈°tiny': 'Fj', 'francouzsky': 'Fj', 'francouzsky jazyk': 'Fj', 'fj': 'Fj', 'frana': 'Fj', 'fr√°na': 'Fj',
                // Ru≈°tina
                'rustina': 'Rj', 'rustiny': 'Rj', 'rusky': 'Rj', 'rj': 'Rj', 'rusky jazyk': 'Rj',
                // Latina
                'latina': 'La', 'latiny': 'La', 'latinske': 'La', 'latinsky': 'La', 'la': 'La',
                // Fyzika
                'fyzika': 'F', 'fyziky': 'F', 'fyzice': 'F', 'fyzik': 'F',
                // Chemie
                'chemie': 'Ch', 'chemii': 'Ch', 'chemik': 'Ch',
                // Biologie
                'biologie': 'Bi', 'biologii': 'Bi', 'bi': 'Bi', 'prirodopis': 'Bi', 'prirodopisu': 'Bi', 'biolog': 'Bi', 'bio': 'Bi', 'biola': 'Bi', 'biolka': 'Bi',
                // Dƒõjepis
                'dejepis': 'D', 'dejepisu': 'D', 'dejak': 'D', 'historie': 'D',
                // Zemƒõpis
                'zemepis': 'Z', 'zemepisu': 'Z', 'zemak': 'Z', 'geografie': 'Z', 'geografia': 'Z',
                // Obƒçansk√° v√Ωchova / ZSV
                'obcanska vychova': 'Ov', 'obƒçansk√° v√Ωchova': 'Ov', 'obcanske vychovy': 'Ov', 'obƒçansk√© v√Ωchovy': 'Ov', 'obcanstvi': 'Ov', 'obƒçanstv√≠': 'Ov', 'ov': 'Ov', 'obcanka': 'Ov', 'obƒçanka': 'Ov', 'v√Ωchova': 'Ov', 'vychova': 'Ov',
                'zsv': 'ZSV', 'zaklady spolecenskych ved': 'ZSV', 'spolecenske vedy': 'ZSV',
                // Ekonomie
                'ekonomie': 'EKS', 'ekonomii': 'EKS', 'ekonomika': 'EKS', 'ekonomiky': 'EKS', 'eks': 'EKS', 'ekon': 'EKS',
                // Informatika
                'informatika': 'IVT', 'informatiky': 'IVT', 'ivt': 'IVT', 'ict': 'IVT', 'pocitace': 'IVT', 'it': 'IVT', 'info≈°ka': 'IVT', 'infoska': 'IVT',
                // Tƒõlesn√° v√Ωchova
                'telesna vychova': 'Tv', 'telesne vychovy': 'Tv', 'telocvik': 'Tv', 'telocviku': 'Tv', 'tv': 'Tv', 'sport': 'Tv',
                // Hudebn√≠ v√Ωchova
                'hudebni vychova': 'Hv', 'hudebn√≠ v√Ωchova': 'Hv', 'hudebni vychovy': 'Hv', 'hudebn√≠ vychovy': 'Hv', 'hv': 'Hv', 'hudba': 'Hv', 'hudby': 'Hv', 'zpev': 'Hv', 'hudebka': 'Hv', 'hudbaƒçka': 'Hv',
                // V√Ωtvarn√° v√Ωchova
                'vytvarnavychova': 'Vv', 'vytvarnavychovy': 'Vv', 'vytvarko': 'Vv', 'vv': 'Vv', 'vytvarka': 'Vv', 'vytvarky': 'Vv', 'art': 'Vv'
            };
            
            // Kontrolujeme, zda zpr√°va obsahuje cel√© slovo nebo fr√°zi
            for (const [keyword, subjectId] of Object.entries(subjectKeywords)) {
                // Pro v√≠ceslovn√© kl√≠ƒçe (obsahuj√≠ mezeru)
                if (keyword.includes(' ')) {
                    if (lowerMessage.includes(keyword)) {
                        return subjectId;
                    }
                } else {
                    // Pro jednoslovn√© kl√≠ƒçe - kontrola cel√©ho slova pomoc√≠ word boundary
                    const regex = new RegExp(`\\b${keyword}\\b`);
                    if (regex.test(lowerMessage)) {
                        return subjectId;
                    }
                }
            }
            
            return null;
        }

        // Funkce pro detekci jm√©na uƒçitele v dotazu
        async function detectTeacherName(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            // Kl√≠ƒçov√° slova, kter√° indikuj√≠ hled√°n√≠ uƒçitele
            const teacherKeywords = ['ucitel', 'ucitelka', 'pan', 'pani', 'mgr', 'paeddr', 'dr'];
            
            // Kontrola, zda zpr√°va obsahuje nƒõjak√© kl√≠ƒçov√© slovo
            let hasTeacherKeyword = false;
            for (const keyword of teacherKeywords) {
                if (lowerMessage.includes(keyword)) {
                    hasTeacherKeyword = true;
                    break;
                }
            }
            
            // Pokud zpr√°va neobsahuje kl√≠ƒçov√© slovo, zkus√≠me naj√≠t jm√©no p≈ô√≠mo
            // Rozdƒõl√≠me zpr√°vu na slova
            const words = lowerMessage.split(/\s+/);
            
            // Hled√°me slova, kter√° vypadaj√≠ jako p≈ô√≠jmen√≠ (alespo≈à 3 znaky)
            for (const word of words) {
                // P≈ôeskoƒç√≠me kr√°tk√° slova a kl√≠ƒçov√° slova
                if (word.length < 3 || teacherKeywords.includes(word) || 
                    ['kontakt', 'ucitele', 'rozvrh', 'jidelna', 'menu'].includes(word)) {
                    continue;
                }
                
                // Zkus√≠me vyhledat uƒçitele s t√≠mto jm√©nem
                const result = await searchTeacherByName(word);
                if (result && result.found) {
                    return result;
                }
            }
            
            return null;
        }
        
        // Funkce pro vyhled√°n√≠ uƒçitele podle jm√©na
        async function searchTeacherByName(name) {
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/kontakt/hledat-ucitele/${encodeURIComponent(name)}`);
                const result = await response.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    return {
                        found: true,
                        name: name,
                        data: result.data,
                        count: result.count
                    };
                }
                
                return { found: false };
            } catch (error) {
                console.error('Chyba p≈ôi hled√°n√≠ uƒçitele:', error);
                return { found: false };
            }
        }
        
        // Funkce pro zobrazen√≠ informac√≠ o uƒçiteli
        async function showTeacherInfo(teacherData) {
            // Vytvo≈ô√≠me form√°tovanou zpr√°vu s daty
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = ''; // Pou≈æijeme innerHTML pro HTML obsah
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            // Vytvo≈ô√≠me HTML strukturu
            let htmlContent = '';
            
            if (teacherData.count === 1) {
                const ucitel = teacherData.data[0];
                htmlContent = `<strong>üë®‚Äçüè´ ${ucitel.jmeno}</strong><br><br>`;
                
                if (ucitel.aprobace) {
                    htmlContent += `üìö Aprobace: ${ucitel.aprobace}<br>`;
                }
                if (ucitel.klapka) {
                    htmlContent += `‚òéÔ∏è Klapka: ${ucitel.klapka}<br>`;
                }
                if (ucitel.email) {
                    htmlContent += `üìß Email: <a href="mailto:${ucitel.email}" style="color: #667eea; text-decoration: none;">${ucitel.email}</a><br>`;
                }
                if (ucitel.konzultace) {
                    htmlContent += `üïê Konzultaƒçn√≠ hodiny: ${ucitel.konzultace}<br>`;
                }
            } else {
                htmlContent = `<strong>üë®‚Äçüè´ Nalezeno ${teacherData.count} uƒçitel≈Ø:</strong><br><br>`;
                
                teacherData.data.forEach(ucitel => {
                    htmlContent += `‚ñ™Ô∏è <strong>${ucitel.jmeno}</strong><br>`;
                    if (ucitel.aprobace) {
                        htmlContent += `&nbsp;&nbsp;&nbsp;Aprobace: ${ucitel.aprobace}<br>`;
                    }
                    if (ucitel.klapka) {
                        htmlContent += `&nbsp;&nbsp;&nbsp;‚òéÔ∏è Klapka: ${ucitel.klapka}<br>`;
                    }
                    if (ucitel.email) {
                        htmlContent += `&nbsp;&nbsp;&nbsp;üìß Email: <a href="mailto:${ucitel.email}" style="color: #667eea; text-decoration: none;">${ucitel.email}</a><br>`;
                    }
                    if (ucitel.konzultace) {
                        htmlContent += `&nbsp;&nbsp;&nbsp;üïê Konzultaƒçn√≠ hodiny: ${ucitel.konzultace}<br>`;
                    }
                    htmlContent += '<br>';
                });
            }
            
            // Pou≈æijeme typing efekt pro HTML obsah
            await typeHtmlMessage(contentDiv, htmlContent, 1);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro odstranƒõn√≠ diakritiky
        function removeDiacritics(str) {
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }
        
        // Funkce pro detekci specifick√© t≈ô√≠dy v rozvrhov√©m dotazu
        function detectRozvrhClass(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            // Mapa t≈ô√≠d s jejich funkcemi
            const classMap = {
                'pa': () => showRozvrhPA(),
                'pb': () => showRozvrhPB(),
                'sa': () => showRozvrhSA(),
                'sb': () => showRozvrhSB(),
                'ta': () => showRozvrhTA(),
                'tb': () => showRozvrhTB(),
                'kva': () => showRozvrhKVA(),
                'kvb': () => showRozvrhKVB(),
                'kvinta': () => showRozvrhTridy('kvinta'),
                'sexta': () => showRozvrhTridy('sexta'),
                'septima': () => showRozvrhTridy('septima'),
                'oktava': () => showRozvrhTridy('oktava')
            };
            
            // Kontrola n√°zvu t≈ô√≠dy (s nebo bez slova "rozvrh")
            for (const [className, func] of Object.entries(classMap)) {
                // P≈ôesn√° shoda nebo slovo "rozvrh" + n√°zev t≈ô√≠dy (ignoruje velikost p√≠smen)
                if (
                    lowerMessage === className ||
                    lowerMessage === className.toUpperCase() ||
                    lowerMessage === className.charAt(0).toUpperCase() + className.slice(1) ||
                    (lowerMessage.includes('rozvrh') && (lowerMessage.includes(className) || lowerMessage.includes(className.toUpperCase()) || lowerMessage.includes(className.charAt(0).toUpperCase() + className.slice(1))))
                ) {
                    return { class: className, func: func };
                }
            }
            
            return null;
        }
        
        // Funkce pro detekci rychl√Ωch odpovƒõd√≠
        function detectQuickReply(message) {
            const lowerMessage = removeDiacritics(message.toLowerCase().trim());
            
            // Kontakt kl√≠ƒçov√° slova (bez diakritiky)
            const kontaktKeywords = ['kontakt', 'kontakty', 'ucitel', 'ucitele', 'ucitele', 'pedagog', 'pedagogove', 'vyucujici', 'vedeni', 'reditel', 'email', 'telefon', 'telefonni cislo'];
            
            // J√≠delna kl√≠ƒçov√° slova (bez diakritiky)
            const jidelnaKeywords = ['jidelna', 'menu', 'obed', 'jidlo', 'strava', 'co je dnes', 'dnesni menu'];
            
            // Rozvrh kl√≠ƒçov√° slova (bez diakritiky)
            const rozvrhKeywords = ['rozvrh', 'hodiny', 'vyucovani', 'vyucovaci hodiny', 'kdy mam'];
            
            // Kontrola kl√≠ƒçov√Ωch slov
            for (const keyword of kontaktKeywords) {
                if (lowerMessage.includes(keyword)) {
                    return 'kontakt';
                }
            }
            
            for (const keyword of jidelnaKeywords) {
                if (lowerMessage.includes(keyword)) {
                    return 'jidelna';
                }
            }
            
            for (const keyword of rozvrhKeywords) {
                if (lowerMessage.includes(keyword)) {
                    return 'rozvrh';
                }
            }
            
            return null;
        }
        
        // Funkce pro zpracov√°n√≠ rychl√© odpovƒõdi
        async function handleQuickReply(type) {
            switch(type) {
                case 'kontakt':
                    // Zobraz√≠me nab√≠dku kontaktn√≠ch mo≈ænost√≠
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.style.maxWidth = '70%';
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    await typeMessage(contentDiv, 'üìß Co tƒõ zaj√≠m√°?\n\n', 30);
                    
                    // P≈ôid√°me tlaƒç√≠tka pro kontakt
                    const buttonsDiv = document.createElement('div');
                    buttonsDiv.style.display = 'flex';
                    buttonsDiv.style.flexDirection = 'column';
                    buttonsDiv.style.gap = '8px';
                    buttonsDiv.style.marginTop = '10px';
                    
                    const vedeniBtn = document.createElement('button');
                    vedeniBtn.className = 'contact-btn';
                    vedeniBtn.textContent = 'üëî Veden√≠ ≈°koly';
                    vedeniBtn.style.width = '100%';
                    vedeniBtn.onclick = showVedeniInfo;
                    
                    const uciteleBtn = document.createElement('button');
                    uciteleBtn.className = 'contact-btn';
                    uciteleBtn.textContent = 'üë®‚Äçüè´ Uƒçitel√©';
                    uciteleBtn.style.width = '100%';
                    uciteleBtn.onclick = showUciteleMenu;
                    
                    const infoBtn = document.createElement('button');
                    infoBtn.className = 'contact-btn';
                    infoBtn.textContent = 'üè´ Z√°kladn√≠ informace';
                    infoBtn.style.width = '100%';
                    infoBtn.onclick = showContact;
                    
                    buttonsDiv.appendChild(vedeniBtn);
                    buttonsDiv.appendChild(uciteleBtn);
                    buttonsDiv.appendChild(infoBtn);
                    contentDiv.appendChild(buttonsDiv);
                    break;
                    
                case 'jidelna':
                    // Otev≈ôeme j√≠delnu
                    await addMessage('üçΩÔ∏è Otev√≠r√°m j√≠deln√≠ l√≠stek...', false);
                    setTimeout(() => showJidelna(), 500);
                    break;
                    
                case 'rozvrh':
                    // Otev≈ôeme rozvrh
                    await addMessage('üìÖ Otev√≠r√°m rozvrh...', false);
                    setTimeout(() => showRozvrh(), 500);
                    break;
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Zobraz zpr√°vu u≈æivatele
            addMessage(message, true);
            userInput.value = '';
            sendBtn.disabled = true;

            // Nejd≈ô√≠v zkontroluj, zda u≈æivatel ≈æ√°d√° rozvrh konkr√©tn√≠ t≈ô√≠dy
            const rozvrhClass = detectRozvrhClass(message);
            if (rozvrhClass) {
                // Rovnou zobraz rozvrh pro danou t≈ô√≠du
                rozvrhClass.func();
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }

            // Zkontroluj dotaz na menu konkr√©tn√≠ho dne
            const requestedDay = detectCanteenDayRequest(message);
            if (requestedDay) {
                await showMenuForDay(requestedDay);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }

            // Zkontroluj dotaz na j√≠delnu (zobraz√≠ modal j√≠delny)
            if (detectCanteenRequest(message)) {
                await addMessage('üçΩÔ∏è Otev√≠r√°m j√≠deln√≠ l√≠stek...', false);
                setTimeout(() => showJidelna(), 500);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }

            // Zkontroluj dotaz na veden√≠ ≈°koly (zobraz√≠ modal kontakt≈Ø)
            if (detectLeadershipRequest(message)) {
                await addMessage('üëî Otev√≠r√°m kontakty veden√≠ ≈°koly...', false);
                setTimeout(() => showContact(), 500);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }

            // Zkontroluj dotaz na konkr√©tn√≠ p≈ôedmƒõt
            const subjectId = detectSubjectRequest(message);
            const hasTeacherKeyword = detectTeacherRequest(message);
            
            // Pokud zpr√°va obsahuje "uƒçitel" + p≈ôedmƒõt ‚Üí zobraz uƒçitele dan√©ho p≈ôedmƒõtu
            if (hasTeacherKeyword && subjectId && subjectId !== null) {
                const subjectNames = {
                    'ƒåj': 'ƒåesk√Ω jazyk', 'M': 'Matematika', 'Aj': 'Angliƒçtina', 
                    'Nj': 'Nƒõmƒçina', '≈†j': '≈†panƒõl≈°tina', 'Fj': 'Francouz≈°tina', 
                    'Rj': 'Ru≈°tina', 'La': 'Latina', 'F': 'Fyzika', 'Ch': 'Chemie', 
                    'Bi': 'Biologie', 'D': 'Dƒõjepis', 'Z': 'Zemƒõpis', 'Ov': 'Obƒçansk√° v√Ωchova',
                    'ZSV': 'Z√°klady spoleƒçensk√Ωch vƒõd', 'EKS': 'Ekonomie', 'IVT': 'Informatika',
                    'Tv': 'Tƒõlesn√° v√Ωchova', 'Hv': 'Hudebn√≠ v√Ωchova', 'Vv': 'V√Ωtvarn√° v√Ωchova'
                };
                const subjectName = subjectNames[subjectId] || subjectId || 'tohoto p≈ôedmƒõtu';
                await addMessage(`üìö Zobrazuji uƒçitele p≈ôedmƒõtu ${subjectName}...`, false);
                setTimeout(() => showUciteleByPredmetModal(subjectName, subjectId), 500);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }
            
            // Pokud zpr√°va obsahuje pouze "uƒçitel" ‚Üí zobraz modal s v√Ωbƒõrem p≈ôedmƒõt≈Ø
            if (hasTeacherKeyword) {
                await addMessage('üë®‚Äçüè´ Otev√≠r√°m v√Ωbƒõr p≈ôedmƒõt≈Ø...', false);
                setTimeout(() => showUciteleModalWindow(), 500);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }
            
            // Pokud zpr√°va obsahuje pouze p≈ôedmƒõt ‚Üí zobraz modal s v√Ωbƒõrem p≈ôedmƒõt≈Ø
            if (subjectId) {
                await addMessage('üë®‚Äçüè´ Otev√≠r√°m v√Ωbƒõr p≈ôedmƒõt≈Ø...', false);
                setTimeout(() => showUciteleModalWindow(), 500);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }

            // Zkontroluj, zda u≈æivatel hled√° uƒçitele podle jm√©na
            const teacherResult = await detectTeacherName(message);
            if (teacherResult && teacherResult.found) {
                await showTeacherInfo(teacherResult);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }

            // Detekuj rychl√© odpovƒõdi
            const quickReplyType = detectQuickReply(message);
            
            if (quickReplyType) {
                // Zpracuj rychlou odpovƒõƒè
                await handleQuickReply(quickReplyType);
                sendBtn.disabled = false;
                userInput.focus();
                return;
            }

            // Zobraz typing indicator
            showTypingIndicator();

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        text: message
                    })
                });

                const data = await response.json();
                
                // Skryj typing indicator
                hideTypingIndicator();
                
                // Zobraz odpovƒõƒè bota
                addMessage(data.reply, false);
                
            } catch (error) {
                hideTypingIndicator();
                addMessage('Omlouv√°m se, nƒõco se pokazilo. Zkus to pros√≠m znovu.', false);
                console.error('Error:', error);
            }

            sendBtn.disabled = false;
            userInput.focus();
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Focus na input p≈ôi naƒçten√≠
        userInput.focus();

        // ===== TOGGLE CHATBOTA =====
        // ===== FUNKCE PRO UV√çTAC√ç BUBLINU =====
        
        // Zobrazen√≠ uv√≠tac√≠ bubliny po naƒçten√≠ str√°nky
        function showWelcomeBubble() {
            const welcomeBubble = document.getElementById('welcomeBubble');
            if (welcomeBubble) {
                // Zobraz√≠me bublinu s m√≠rn√Ωm zpo≈ædƒõn√≠m pro efekt
                setTimeout(() => {
                    welcomeBubble.classList.add('show');
                }, 1000);
                
                // Automaticky skr√Ωt po 10 sekund√°ch
                setTimeout(() => {
                    closeWelcomeBubble();
                }, 11000);
            }
        }
        
        // Zav≈ôen√≠ uv√≠tac√≠ bubliny
        function closeWelcomeBubble() {
            const welcomeBubble = document.getElementById('welcomeBubble');
            if (welcomeBubble) {
                welcomeBubble.classList.remove('show');
                // Po animaci √∫plnƒõ skr√Ωt
                setTimeout(() => {
                    welcomeBubble.style.display = 'none';
                }, 500);
            }
        }
        
        function toggleChat() {
            const chatWidget = document.getElementById('chatWidget');
            const toggleBtn = document.getElementById('chatToggleBtn');
            const icon = toggleBtn.querySelector('.icon');
            const chatBadge = document.getElementById('chatBadge');
            
            // P≈ôi otev≈ôen√≠ chatu zav≈ôeme uv√≠tac√≠ bublinu
            closeWelcomeBubble();
            
            if (chatWidget.classList.contains('hidden')) {
                // Otev≈ô√≠t chat
                chatWidget.classList.remove('hidden');
                toggleBtn.classList.add('active');
                toggleBtn.classList.remove('pulse');
                icon.textContent = '‚úï';
                
                // Skr√Ωt badge p≈ôi otev≈ôen√≠
                if (chatBadge) {
                    chatBadge.classList.remove('show');
                }
                
                // Zobrazit uv√≠tac√≠ zpr√°vu p≈ôi prvn√≠m otev≈ôen√≠
                if (!welcomeShown) {
                    welcomeShown = true;
                    setTimeout(showWelcomeMessage, 300);
                }
                
                // Focus na input p≈ôi otev≈ôen√≠
                setTimeout(() => {
                    userInput.focus();
                }, 400);
            } else {
                // Zav≈ô√≠t chat
                chatWidget.classList.add('hidden');
                toggleBtn.classList.remove('active');
                toggleBtn.classList.add('pulse');
                icon.textContent = 'üí¨';
            }
        }

        // Zav≈ô√≠t chat p≈ôi kliku mimo nƒõj (optional)
        document.addEventListener('click', (e) => {
            const chatWidget = document.getElementById('chatWidget');
            const toggleBtn = document.getElementById('chatToggleBtn');
            
            // Zav≈ô√≠t pouze pokud klik nen√≠ na chat ani na tlaƒç√≠tko
            if (!chatWidget.contains(e.target) && 
                !toggleBtn.contains(e.target) && 
                !chatWidget.classList.contains('hidden')) {
                // Zakomentov√°no - m≈Ø≈æe≈° odkomentovat pokud chce≈° auto-zav√≠r√°n√≠
                // toggleChat();
            }
        });
        
        // Inicializace p≈ôi naƒçten√≠ str√°nky
        window.addEventListener('load', function() {
            // Zobraz√≠me uv√≠tac√≠ bublinu po naƒçten√≠
            showWelcomeBubble();
        });
    </script>
</body>
</html>
