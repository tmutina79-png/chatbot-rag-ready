<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATIƒå√ÅK - Matiƒçn√≠ AI Pomocn√≠k</title>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            font-style: italic;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .chat-container {
            flex: 2;
            overflow-y: auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 12px;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            max-width: 66.66%;
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        #userInput {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #sendBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #sendBtn:active {
            transform: translateY(0);
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 12px 18px;
            background: white;
            border-radius: 18px;
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator.active {
            display: block;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .footer {
            padding: 15px 20px;
            text-align: center;
            font-size: 11px;
            color: #999;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .footer-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-logo {
            height: 30px;
            width: auto;
            opacity: 0.8;
        }

        .typing-toggle-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .typing-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }

        .typing-toggle-btn.instant {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .contact-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 24px;
            background: transparent;
            color: #000000;
            border: 2px solid #000000;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .contact-btn:hover {
            background: #000000;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* Modal styly */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-in;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
            font-size: 24px;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #333;
        }

        .modal-body {
            color: #333;
            font-size: 14px;
            line-height: 1.6;
        }

        .modal-body h3 {
            color: #667eea;
            font-size: 18px;
            margin: 20px 0 10px 0;
        }

        .modal-body p {
            margin: 8px 0;
        }

        .modal-body a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s;
        }

        .modal-body a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .contact-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .contact-link {
            display: block;
            padding: 12px 20px;
            background: transparent;
            color: #667eea;
            text-decoration: none;
            border: 2px solid #667eea;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }

        .contact-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        /* Styly pro p≈ôedmƒõtov√© tlaƒç√≠tka */
        .predmet-btn {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            background: transparent;
            color: #667eea;
            text-decoration: none;
            border: 2px solid #667eea;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .predmet-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .predmety-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ MATIƒå√ÅK</h1>
            <p>Matiƒçn√≠ AI Pomocn√≠k</p>
        </div>
        
        <div class="chat-container" id="chatContainer">
        </div>
        
        <div class="input-container">
            <input 
                type="text" 
                id="userInput" 
                placeholder="Napi≈° svou zpr√°vu..." 
                autocomplete="off"
            >
            <button id="sendBtn">Odeslat</button>
        </div>
        
        <div class="footer">
            <div class="footer-content">
                <img src="/static/logo_mgo.jpeg" alt="MGO Logo" class="footer-logo">
                <span>Vytvo≈ôili ≈æ√°ci Matiƒçn√≠ho gymn√°zia Ostrava</span>
            </div>
            <button id="typingToggleBtn" class="typing-toggle-btn" onclick="toggleTypingEffect()">
                ‚ö° P≈ôeskoƒçit typing
            </button>
        </div>
    </div>

    <!-- Modal okno pro kontakt -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìß Kontakt</h2>
                <button class="close-btn" onclick="closeContactModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h3>Matiƒçn√≠ gymn√°zium Ostrava</h3>
                <p><strong>üìß E-mail:</strong> <a href="mailto:info@mgo.cz">info@mgo.cz</a></p>
                <p><strong>üìû Telefon:</strong> <a href="tel:+420596136632">+420 596 136 632</a></p>
                
                <div class="contact-links">
                    <a href="#" onclick="showVedeniInfo(event)" class="contact-link">
                        üëî Veden√≠ ≈°koly
                    </a>
                    <a href="#" onclick="showUciteleMenu(event)" class="contact-link">
                        üë®‚Äçüè´ Uƒçitel√©
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal okno pro j√≠delnu -->
    <div id="jidelnaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üçΩÔ∏è J√≠delna</h2>
                <button class="close-btn" onclick="closeJidelnaModal()">&times;</button>
            </div>
            <div class="modal-body" id="jidelnaModalBody">
                <p>‚è≥ Naƒç√≠t√°m informace o j√≠delnƒõ...</p>
            </div>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        
        // Glob√°ln√≠ promƒõnn√© pro typing efekt
        let typingEnabled = true;
        let currentTypingElement = null;
        let currentFullText = '';
        let skipTyping = false;
        
        // Funkce pro p≈ôep√≠n√°n√≠/skip typing efektu
        function toggleTypingEffect() {
            const btn = document.getElementById('typingToggleBtn');
            
            // Pokud se nƒõco pr√°vƒõ vypisuje, okam≈æitƒõ to dokonƒç√≠me
            if (currentTypingElement && currentFullText) {
                skipTyping = true;
                currentTypingElement.textContent = currentFullText;
                btn.textContent = '‚ö° Dokonƒçeno';
                
                // Po chv√≠li vr√°t√≠me tlaƒç√≠tko do p≈Øvodn√≠ho stavu
                setTimeout(() => {
                    btn.textContent = '‚ö° P≈ôeskoƒçit typing';
                    skipTyping = false;
                }, 1000);
            }
        }
        
        // Funkce pro zobrazen√≠ kontaktu
        function showContact() {
            document.getElementById('contactModal').style.display = 'block';
        }
        
        // Funkce pro zobrazen√≠ j√≠delny - dne≈°n√≠ menu
        async function showJidelna() {
            // Otev≈ôeme modal
            document.getElementById('jidelnaModal').style.display = 'block';
            const modalBody = document.getElementById('jidelnaModalBody');
            modalBody.innerHTML = '<p>‚è≥ Naƒç√≠t√°m dne≈°n√≠ menu...</p>';
            
            try {
                // Naƒçteme dne≈°n√≠ menu z backendu
                const response = await fetch(`${CONFIG.API_BASE_URL}/jidelna/dnesni-menu`);
                const result = await response.json();
                
                if (result.success && result.data) {
                    // Zaƒçneme vytv√°≈ôet HTML strukturu postupnƒõ
                    let htmlContent = `<h3>üçΩÔ∏è Dne≈°n√≠ menu - ${result.data.den} ${result.data.datum}</h3>`;
                    
                    if (result.data.menu && result.data.menu.length > 0) {
                        // Zobraz√≠me postupnƒõ ka≈æd√© j√≠dlo
                        for (const jidlo of result.data.menu) {
                            htmlContent += `<p><strong>${jidlo.typ}:</strong><br>${jidlo.nazev}</p>`;
                            // Aktualizujeme obsah pr≈Øbƒõ≈ænƒõ
                            modalBody.innerHTML = htmlContent + '<div class="contact-links"><a href="#" onclick="showTydenniMenuInChat(event)" class="contact-link">üìÖ T√Ωdenn√≠ menu</a><a href="http://obedy.zs-mat5.cz/login" target="_blank" class="contact-link">üõí Objednat obƒõd</a></div>';
                            // P≈ôid√°me kr√°tkou pauzu pro plynul√© zobrazen√≠
                            await new Promise(resolve => setTimeout(resolve, 200));
                        }
                    } else {
                        htmlContent += '<p>Dnes nen√≠ k dispozici ≈æ√°dn√© menu.</p>';
                    }
                    
                    // P≈ôid√°me tlaƒç√≠tka na konec
                    htmlContent += '<div class="contact-links">';
                    htmlContent += '<a href="#" onclick="showTydenniMenuInChat(event)" class="contact-link">üìÖ T√Ωdenn√≠ menu</a>';
                    htmlContent += '<a href="http://obedy.zs-mat5.cz/login" target="_blank" class="contact-link">üõí Objednat obƒõd</a>';
                    htmlContent += '</div>';
                    
                    modalBody.innerHTML = htmlContent;
                } else {
                    modalBody.innerHTML = '<p>‚ùå Nepoda≈ôilo se naƒç√≠st dne≈°n√≠ menu. Zkus to pros√≠m pozdƒõji.</p>';
                }
                
            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ menu:', error);
                modalBody.innerHTML = '<p>‚ùå Do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ informac√≠. Zkus to pros√≠m znovu.</p>';
            }
        }
        
        // Funkce pro zobrazen√≠ t√Ωdenn√≠ho menu v chatu
        async function showTydenniMenuInChat(event) {
            if (event) event.preventDefault();
            
            // Zav≈ôeme modal
            closeJidelnaModal();
            
            // Zobraz√≠me loading zpr√°vu v chatu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'tydenniMenuLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            loadingContent.textContent = '‚è≥ Naƒç√≠t√°m t√Ωdenn√≠ menu...';
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/jidelna/tydenni-menu`);
                const result = await response.json();
                
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('tydenniMenuLoading');
                if (loading) loading.remove();
                
                if (result.success && result.data) {
                    // Vytvo≈ô√≠me form√°tovanou zpr√°vu s t√Ωdenn√≠m menu
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.innerHTML = '';
                    contentDiv.style.maxWidth = '80%'; // ≈†ir≈°√≠ pro lep≈°√≠ zobrazen√≠
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    // Postupnƒõ vytv√°≈ô√≠me a zobrazujeme obsah
                    // Hlavn√≠ nadpis
                    contentDiv.innerHTML = '<h3 style="color: #667eea; font-size: 18px; margin: 0 0 15px 0;">üìÖ T√Ωdenn√≠ j√≠deln√≠ l√≠stek</h3>';
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    if (result.data.dny && result.data.dny.length > 0) {
                        for (const den of result.data.dny) {
                            // P≈ôid√°me den
                            contentDiv.innerHTML += `<h3 style="color: #667eea; font-size: 16px; margin: 15px 0 10px 0;">${den.den}</h3>`;
                            chatContainer.scrollTop = chatContainer.scrollHeight;
                            await new Promise(resolve => setTimeout(resolve, 200));
                            
                            // Postupnƒõ p≈ôid√°me ka≈æd√© j√≠dlo
                            for (const jidlo of den.menu) {
                                contentDiv.innerHTML += `<p style="margin: 8px 0;"><strong>${jidlo.typ}:</strong><br>${jidlo.nazev}</p>`;
                                chatContainer.scrollTop = chatContainer.scrollHeight;
                                await new Promise(resolve => setTimeout(resolve, 150));
                            }
                        }
                        
                        // P≈ôid√°me odkaz na objedn√°n√≠
                        contentDiv.innerHTML += '<p style="margin-top: 15px; font-style: italic;">üí° Pro objedn√°n√≠ nav≈°tivte: <a href="http://obedy.zs-mat5.cz/login" target="_blank" style="color: #667eea; text-decoration: none;">obedy.zs-mat5.cz</a></p>';
                    } else {
                        contentDiv.innerHTML += '<p>T√Ωdenn√≠ menu nen√≠ k dispozici.</p>';
                    }
                } else {
                    addMessage('‚ùå Nepoda≈ôilo se naƒç√≠st t√Ωdenn√≠ menu. Zkus to pros√≠m pozdƒõji.', false);
                }
                
            } catch (error) {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('tydenniMenuLoading');
                if (loading) loading.remove();
                
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ t√Ωdenn√≠ho menu:', error);
                addMessage('‚ùå Do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ t√Ωdenn√≠ho menu. Zkus to pros√≠m znovu.', false);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zav≈ôen√≠ modalu
        function closeContactModal() {
            document.getElementById('contactModal').style.display = 'none';
        }
        
        // Funkce pro zav≈ôen√≠ j√≠delna modalu
        function closeJidelnaModal() {
            document.getElementById('jidelnaModal').style.display = 'none';
        }
        
        // Zav≈ôen√≠ modalu p≈ôi kliknut√≠ mimo nƒõj
        window.onclick = function(event) {
            const contactModal = document.getElementById('contactModal');
            const jidelnaModal = document.getElementById('jidelnaModal');
            
            if (event.target === contactModal) {
                contactModal.style.display = 'none';
            }
            if (event.target === jidelnaModal) {
                jidelnaModal.style.display = 'none';
            }
        }
        
        // Funkce pro zobrazen√≠ informac√≠ o veden√≠ ≈°koly
        async function showVedeniInfo(event) {
            event.preventDefault();
            closeContactModal();
            
            // Zobraz√≠me loading zpr√°vu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'vedeniLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            loadingContent.textContent = '‚è≥ Naƒç√≠t√°m informace o veden√≠ ≈°koly...';
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                // Naƒçteme data z backendu
                const response = await fetch(`${CONFIG.API_BASE_URL}/kontakt/vedeni`);
                const result = await response.json();
                
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('vedeniLoading');
                if (loading) loading.remove();
                
                if (result.success && result.data) {
                    // Vytvo≈ô√≠me form√°tovanou zpr√°vu s daty
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.innerHTML = ''; // Pou≈æijeme innerHTML pro HTML obsah
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    // Vytvo≈ô√≠me HTML strukturu s klikac√≠mi odkazy
                    let htmlContent = "<strong>üëî Veden√≠ ≈°koly - Matiƒçn√≠ gymn√°zium Ostrava</strong><br><br>";
                    
                    result.data.forEach(osoba => {
                        htmlContent += `‚ñ™Ô∏è ${osoba.jmeno}<br>`;
                        htmlContent += `&nbsp;&nbsp;&nbsp;Pozice: ${osoba.pozice}<br>`;
                        if (osoba.email) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üìß Email: <a href="mailto:${osoba.email}" style="color: #667eea; text-decoration: none;">${osoba.email}</a><br>`;
                        }
                        if (osoba.telefon) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üìû Telefon: ${osoba.telefon}<br>`;
                        }
                        htmlContent += '<br>';
                    });
                    
                    // Pou≈æijeme typing efekt pro HTML obsah
                    await typeHtmlMessage(contentDiv, htmlContent, 30);
                } else {
                    // Zobraz√≠me chybovou zpr√°vu s typing efektem
                    addMessage('Omlouv√°m se, nepoda≈ôilo se naƒç√≠st informace o veden√≠ ≈°koly. Zkus to pros√≠m pozdƒõji.', false);
                }
                
            } catch (error) {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('vedeniLoading');
                if (loading) loading.remove();
                
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ veden√≠:', error);
                addMessage('Omlouv√°m se, do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ informac√≠. Zkus to pros√≠m znovu.', false);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ menu s p≈ôedmƒõty
        async function showUciteleMenu(event) {
            event.preventDefault();
            closeContactModal();
            
            // Vytvo≈ô√≠me zpr√°vu s tlaƒç√≠tky p≈ôedmƒõt≈Ø
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '70%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            // Typing efekt pro √∫vodn√≠ text
            await typeMessage(contentDiv, 'üë®‚Äçüè´ Vyber p≈ôedmƒõt pro zobrazen√≠ uƒçitel≈Ø:\n\n', 30);
            
            // P≈ôid√°me kontejner pro tlaƒç√≠tka p≈ôedmƒõt≈Ø
            const predmetyContainer = document.createElement('div');
            predmetyContainer.className = 'predmety-container';
            
            // Seznam p≈ôedmƒõt≈Ø
            const predmety = [
                { nazev: 'ƒåesk√Ω jazyk', id: 'cestina' },
                { nazev: 'Matematika', id: 'matematika' },
                { nazev: 'Angliƒçtina', id: 'anglictina' },
                { nazev: 'Nƒõmƒçina', id: 'nemcina' },
                { nazev: 'Fyzika', id: 'fyzika' },
                { nazev: 'Chemie', id: 'chemie' },
                { nazev: 'Biologie', id: 'biologie' },
                { nazev: 'Dƒõjepis', id: 'dejepis' },
                { nazev: 'Zemƒõpis', id: 'zemepis' },
                { nazev: 'Informatika', id: 'informatika' },
                { nazev: 'Tƒõlesn√° v√Ωchova', id: 'tv' },
                { nazev: 'Hudebn√≠ v√Ωchova', id: 'hv' }
            ];
            
            // Vytvo≈ô√≠me tlaƒç√≠tko pro ka≈æd√Ω p≈ôedmƒõt
            predmety.forEach(predmet => {
                const btn = document.createElement('button');
                btn.className = 'predmet-btn';
                btn.textContent = predmet.nazev;
                btn.onclick = () => showUciteleByPredmet(predmet.nazev, predmet.id);
                predmetyContainer.appendChild(btn);
            });
            
            contentDiv.appendChild(predmetyContainer);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Funkce pro zobrazen√≠ uƒçitel≈Ø dan√©ho p≈ôedmƒõtu
        async function showUciteleByPredmet(nazevPredmetu, idPredmetu) {
            // Zobraz√≠me loading zpr√°vu
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot';
            loadingDiv.id = 'uciteleLoading';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            loadingContent.textContent = `‚è≥ Naƒç√≠t√°m uƒçitele p≈ôedmƒõtu ${nazevPredmetu}...`;
            
            loadingDiv.appendChild(loadingContent);
            chatContainer.appendChild(loadingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            try {
                // Naƒçteme data z backendu
                const response = await fetch(`${CONFIG.API_BASE_URL}/kontakt/ucitele/${idPredmetu}`);
                const result = await response.json();
                
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('uciteleLoading');
                if (loading) loading.remove();
                
                if (result.success && result.data && result.data.length > 0) {
                    // Vytvo≈ô√≠me form√°tovanou zpr√°vu s daty
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message bot';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'message-content';
                    contentDiv.innerHTML = ''; // Pou≈æijeme innerHTML pro HTML obsah
                    
                    messageDiv.appendChild(contentDiv);
                    chatContainer.appendChild(messageDiv);
                    
                    // Vytvo≈ô√≠me HTML strukturu s klikac√≠mi odkazy
                    let htmlContent = `<strong>üìö ${result.predmet} - Vyuƒçuj√≠c√≠</strong><br><br>`;
                    
                    result.data.forEach(ucitel => {
                        htmlContent += `‚ñ™Ô∏è ${ucitel.jmeno}<br>`;
                        if (ucitel.aprobace) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;Aprobace: ${ucitel.aprobace}<br>`;
                        }
                        if (ucitel.klapka) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;‚òéÔ∏è Klapka: ${ucitel.klapka}<br>`;
                        }
                        if (ucitel.email) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üìß Email: <a href="mailto:${ucitel.email}" style="color: #667eea; text-decoration: none;">${ucitel.email}</a><br>`;
                        }
                        if (ucitel.konzultace) {
                            htmlContent += `&nbsp;&nbsp;&nbsp;üïê Konzultaƒçn√≠ hodiny: ${ucitel.konzultace}<br>`;
                        }
                        htmlContent += '<br>';
                    });
                    
                    // Pou≈æijeme typing efekt pro HTML obsah
                    await typeHtmlMessage(contentDiv, htmlContent, 30);
                } else {
                    // Zobraz√≠me zpr√°vu, ≈æe nebyli nalezeni uƒçitel√©
                    addMessage(`üìö ${nazevPredmetu}\n\nBohu≈æel nebyly nalezeny ≈æ√°dn√© informace o uƒçitel√≠ch pro tento p≈ôedmƒõt.`, false);
                }
                
            } catch (error) {
                // Odstran√≠me loading zpr√°vu
                const loading = document.getElementById('uciteleLoading');
                if (loading) loading.remove();
                
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ uƒçitel≈Ø:', error);
                addMessage('Omlouv√°m se, do≈°lo k chybƒõ p≈ôi naƒç√≠t√°n√≠ informac√≠. Zkus to pros√≠m znovu.', false);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // Generuj unik√°tn√≠ user ID nebo pou≈æij existuj√≠c√≠ z localStorage
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }

        // Funkce pro typing efekt (p√≠smenka po p√≠smenku)
        async function typeMessage(element, text, speed = 50) {
            if (!typingEnabled) {
                // Okam≈æit√© zobrazen√≠ bez typing efektu
                element.textContent = text;
                return;
            }
            
            // Nastav√≠me glob√°ln√≠ promƒõnn√© pro mo≈ænost p≈ôeskoƒçen√≠
            currentTypingElement = element;
            currentFullText = text;
            skipTyping = false;
            
            for (let i = 0; i < text.length; i++) {
                // Pokud bylo po≈æadov√°no p≈ôeskoƒçen√≠, ukonƒç√≠me smyƒçku
                if (skipTyping) {
                    break;
                }
                
                element.textContent += text.charAt(i);
                await new Promise(resolve => setTimeout(resolve, speed));
            }
            
            // Po dokonƒçen√≠ vynulujeme glob√°ln√≠ promƒõnn√©
            currentTypingElement = null;
            currentFullText = '';
        }

        // Funkce pro typing efekt s HTML obsahem
        async function typeHtmlMessage(element, htmlContent, speed = 30) {
            if (!typingEnabled) {
                // Okam≈æit√© zobrazen√≠ bez typing efektu
                element.innerHTML = htmlContent;
                return;
            }
            
            // Nastav√≠me glob√°ln√≠ promƒõnn√© pro mo≈ænost p≈ôeskoƒçen√≠
            currentTypingElement = element;
            currentFullText = htmlContent;
            skipTyping = false;
            
            // P≈ôevedeme HTML na text pro typing efekt
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            const plainText = tempDiv.textContent || tempDiv.innerText || '';
            
            // Bƒõhem typingu zobrazujeme jako prost√Ω text
            for (let i = 0; i < plainText.length; i++) {
                if (skipTyping) {
                    break;
                }
                
                element.textContent += plainText.charAt(i);
                await new Promise(resolve => setTimeout(resolve, speed));
            }
            
            // Po dokonƒçen√≠ typingu nahrad√≠me HTML verz√≠ s odkazy
            element.innerHTML = htmlContent;
            
            // Po dokonƒçen√≠ vynulujeme glob√°ln√≠ promƒõnn√©
            currentTypingElement = null;
            currentFullText = '';
        }

        // Zobrazen√≠ uv√≠tac√≠ zpr√°vy s typing efektem
        async function showWelcomeMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.style.maxWidth = '70%';
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);

            // Typing efekt pro uv√≠tac√≠ zpr√°vu
            await typeMessage(contentDiv, 'Ahoj! üëã Jsem MATIƒå√ÅK, tv≈Øj ≈°koln√≠ AI pomocn√≠k. Jak ti m≈Ø≈æu dnes pomoci?', 50);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Po dokonƒçen√≠ textu p≈ôid√°me tlaƒç√≠tka kontakt a j√≠delna pod zpr√°vu
            await new Promise(resolve => setTimeout(resolve, 300));
            
            const buttonsDiv = document.createElement('div');
            buttonsDiv.className = 'message bot';
            buttonsDiv.style.marginTop = '5px';
            buttonsDiv.style.display = 'flex';
            buttonsDiv.style.gap = '10px';
            
            const contactBtn = document.createElement('button');
            contactBtn.className = 'contact-btn';
            contactBtn.textContent = 'üìß Kontakt';
            contactBtn.onclick = showContact;
            
            const jidelnaBtn = document.createElement('button');
            jidelnaBtn.className = 'contact-btn';
            jidelnaBtn.textContent = 'üçΩÔ∏è J√≠delna';
            jidelnaBtn.onclick = showJidelna;
            
            buttonsDiv.appendChild(contactBtn);
            buttonsDiv.appendChild(jidelnaBtn);
            chatContainer.appendChild(buttonsDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Zabr√°n√≠me opakovan√©mu spu≈°tƒõn√≠
        let welcomeShown = false;

        // Spust√≠me uv√≠tac√≠ zpr√°vu po naƒçten√≠
        window.addEventListener('load', () => {
            if (!welcomeShown) {
                welcomeShown = true;
                setTimeout(showWelcomeMessage, 500);
            }
        });

        function addMessage(text, isUser) {

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (isUser) {
                // U≈æivatelsk√© zpr√°vy bez typing efektu
                contentDiv.textContent = text;
            } else {
                // Bot zpr√°vy s typing efektem
                contentDiv.textContent = '';
            }
            
            messageDiv.appendChild(contentDiv);
            chatContainer.appendChild(messageDiv);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Spust√≠me typing efekt pro bot zpr√°vy
            if (!isUser) {
                typeMessage(contentDiv, text, 30);
            }
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator active';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            
            typingDiv.appendChild(indicator);
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Zobraz zpr√°vu u≈æivatele
            addMessage(message, true);
            userInput.value = '';
            sendBtn.disabled = true;

            // Zobraz typing indicator
            showTypingIndicator();

            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        text: message
                    })
                });

                const data = await response.json();
                
                // Skryj typing indicator
                hideTypingIndicator();
                
                // Zobraz odpovƒõƒè bota
                addMessage(data.reply, false);
                
            } catch (error) {
                hideTypingIndicator();
                addMessage('Omlouv√°m se, nƒõco se pokazilo. Zkus to pros√≠m znovu.', false);
                console.error('Error:', error);
            }

            sendBtn.disabled = false;
            userInput.focus();
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Focus na input p≈ôi naƒçten√≠
        userInput.focus();
    </script>
</body>
</html>
